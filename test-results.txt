
> cubicler@2.3.0 test:run
> vitest --run


 RUN  v3.2.4 /Users/nayandahaberty/Code/Cubicler/Cubicler

stdout | tests/transport/agent/sse-agent-transport.test.ts > SseAgentTransport > registerAgentConnection > should register agent connection and set up SSE headers
✅ [SseAgentTransport] Agent test-agent connected via SSE

stdout | tests/transport/agent/sse-agent-transport.test.ts > SseAgentTransport > registerAgentConnection > should set up close event handler
✅ [SseAgentTransport] Agent test-agent connected via SSE

stdout | tests/transport/agent/sse-agent-transport.test.ts > SseAgentTransport > dispatch > should send request to connected agent via SSE
✅ [SseAgentTransport] Agent test-agent connected via SSE
🚀 [SseAgentTransport] Dispatching request to agent test-agent
📡 [SseAgentTransport] Request test-agent_1754459432026_zzw5ol0 sent to agent test-agent

stdout | tests/transport/agent/sse-agent-transport.test.ts > SseAgentTransport > dispatch > should timeout if agent does not respond
✅ [SseAgentTransport] Agent test-agent connected via SSE
🚀 [SseAgentTransport] Dispatching request to agent test-agent
📡 [SseAgentTransport] Request test-agent_1754459432092_l9shbax sent to agent test-agent

stdout | tests/transport/agent/stdio-agent-transport.test.ts > StdioAgentTransport > call > should call agent successfully
🚀 [StdioAgentTransport] Calling agent: python3 /path/to/agent.py --config test

stdout | tests/transport/agent/stdio-agent-transport.test.ts > StdioAgentTransport > call > should call agent successfully
✅ [StdioAgentTransport] Agent responded successfully

stdout | tests/transport/agent/stdio-agent-transport.test.ts > StdioAgentTransport > call > should handle process exit with non-zero code
🚀 [StdioAgentTransport] Calling agent: python3 /path/to/agent.py --config test

stdout | tests/transport/agent/stdio-agent-transport.test.ts > StdioAgentTransport > call > should handle invalid JSON response
🚀 [StdioAgentTransport] Calling agent: python3 /path/to/agent.py --config test

stdout | tests/transport/agent/stdio-agent-transport.test.ts > StdioAgentTransport > call > should handle missing required fields in response
🚀 [StdioAgentTransport] Calling agent: python3 /path/to/agent.py --config test

stdout | tests/transport/agent/stdio-agent-transport.test.ts > StdioAgentTransport > call > should handle process spawn error
🚀 [StdioAgentTransport] Calling agent: python3 /path/to/agent.py --config test

stdout | tests/transport/agent/sse-agent-transport.test.ts > SseAgentTransport > handleAgentResponse > should resolve pending request when response received
✅ [SseAgentTransport] Agent test-agent connected via SSE
🚀 [SseAgentTransport] Dispatching request to agent test-agent
📡 [SseAgentTransport] Request test-agent_1754459432207_ldo08ua sent to agent test-agent

stderr | tests/transport/agent/sse-agent-transport.test.ts > SseAgentTransport > handleAgentResponse > should resolve pending request when response received
⚠️ [SseAgentTransport] Received response for unknown request test-request-123 from agent test-agent

stdout | tests/transport/agent/stdio-agent-transport.test.ts > StdioAgentTransport > call > should handle timeout
🚀 [StdioAgentTransport] Calling agent: python3 /path/to/agent.py --config test

stdout | tests/transport/agent/sse-agent-transport.test.ts > SseAgentTransport > isAgentConnected > should return true when agent is connected
✅ [SseAgentTransport] Agent test-agent connected via SSE

stdout | tests/transport/agent/sse-agent-transport.test.ts > SseAgentTransport > isAgentConnected > should return false when response is destroyed
✅ [SseAgentTransport] Agent test-agent connected via SSE

stdout | tests/transport/agent/sse-agent-transport.test.ts > SseAgentTransport > disconnect > should end response and clear connection
✅ [SseAgentTransport] Agent test-agent connected via SSE
🔄 [SseAgentTransport] Agent test-agent transport disconnected

stdout | tests/transport/agent/sse-agent-transport.test.ts > SseAgentTransport > disconnect > should reject pending requests on disconnect
✅ [SseAgentTransport] Agent test-agent connected via SSE
🚀 [SseAgentTransport] Dispatching request to agent test-agent
📡 [SseAgentTransport] Request test-agent_1754459432231_j1h3zit sent to agent test-agent
🔄 [SseAgentTransport] Agent test-agent transport disconnected

stdout | tests/transport/agent/sse-agent-transport.test.ts > SseAgentTransport > disconnect > should handle disconnect when response is already destroyed
✅ [SseAgentTransport] Agent test-agent connected via SSE
🔄 [SseAgentTransport] Agent test-agent transport disconnected

stdout | tests/transport/agent/sse-agent-transport.test.ts > SseAgentTransport > connection close handling > should handle agent disconnection
✅ [SseAgentTransport] Agent test-agent connected via SSE
🚀 [SseAgentTransport] Dispatching request to agent test-agent
📡 [SseAgentTransport] Request test-agent_1754459432232_kx9zbzc sent to agent test-agent
🔄 [SseAgentTransport] Agent test-agent disconnected

 ✓ tests/transport/agent/sse-agent-transport.test.ts (17 tests) 225ms
 ✓ tests/utils/cache.test.ts (13 tests) 180ms
stdout | tests/transport/agent/stdio-agent-transport.test.ts > StdioAgentTransport > call > should handle process killed by signal
🚀 [StdioAgentTransport] Calling agent: python3 /path/to/agent.py --config test

stdout | tests/transport/agent/stdio-agent-transport.test.ts > StdioAgentTransport > call > should handle stdin write error
🚀 [StdioAgentTransport] Calling agent: python3 /path/to/agent.py --config test

 ✓ tests/transport/agent/stdio-agent-transport.test.ts (12 tests) 200ms
stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > initialize > should initialize SSE transport successfully
🔄 [SseMCPTransport] Connecting to SSE endpoint: http://localhost:3000/sse

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > initialize > should initialize SSE transport successfully
✅ [SseMCPTransport] SSE connection opened for test-sse-server

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > initialize > should initialize SSE transport successfully
✅ [SseMCPTransport] Initialized SSE transport for test-sse-server

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > sendRequest > should send request and receive response via SSE
🔄 [SseMCPTransport] Connecting to SSE endpoint: http://localhost:3000/sse

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > sendRequest > should send request and receive response via SSE
✅ [SseMCPTransport] SSE connection opened for test-sse-server

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > sendRequest > should send request and receive response via SSE
✅ [SseMCPTransport] Initialized SSE transport for test-sse-server

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > sendRequest > should send request and receive response via SSE
📡 [SseMCPTransport] Sending SSE request to test-sse-server: tools/list

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > sendRequest > should send request and receive response via SSE
✅ [SseMCPTransport] HTTP request sent to test-sse-server

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > sendRequest > should send request and receive response via SSE
✅ [SseMCPTransport] Received SSE response for test-sse-server request 1

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > sendRequest > should handle custom mcp-response event
🔄 [SseMCPTransport] Connecting to SSE endpoint: http://localhost:3000/sse

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > sendRequest > should handle custom mcp-response event
✅ [SseMCPTransport] SSE connection opened for test-sse-server

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > sendRequest > should handle custom mcp-response event
✅ [SseMCPTransport] Initialized SSE transport for test-sse-server

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > sendRequest > should handle custom mcp-response event
📡 [SseMCPTransport] Sending SSE request to test-sse-server: tools/list

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > sendRequest > should handle custom mcp-response event
✅ [SseMCPTransport] HTTP request sent to test-sse-server

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > sendRequest > should handle custom mcp-response event
✅ [SseMCPTransport] Received SSE response for test-sse-server request 1

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > sendRequest > should timeout if response not received
🔄 [SseMCPTransport] Connecting to SSE endpoint: http://localhost:3000/sse

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > sendRequest > should timeout if response not received
✅ [SseMCPTransport] SSE connection opened for test-sse-server

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > sendRequest > should timeout if response not received
✅ [SseMCPTransport] Initialized SSE transport for test-sse-server

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > sendRequest > should timeout if response not received
📡 [SseMCPTransport] Sending SSE request to test-sse-server: tools/list

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > sendRequest > should timeout if response not received
✅ [SseMCPTransport] HTTP request sent to test-sse-server

 ✓ tests/repository/agent-repository.test.ts (15 tests) 192ms
stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > sendRequest > should throw error if transport not initialized
🔄 [SseMCPTransport] Connecting to SSE endpoint: http://localhost:3000/sse

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > sendRequest > should throw error if transport not initialized
✅ [SseMCPTransport] SSE connection opened for test-sse-server

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > sendRequest > should throw error if transport not initialized
✅ [SseMCPTransport] Initialized SSE transport for test-sse-server

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > sendRequest > should throw error if SSE connection is not open
🔄 [SseMCPTransport] Connecting to SSE endpoint: http://localhost:3000/sse

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > sendRequest > should throw error if SSE connection is not open
✅ [SseMCPTransport] SSE connection opened for test-sse-server

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > sendRequest > should throw error if SSE connection is not open
✅ [SseMCPTransport] Initialized SSE transport for test-sse-server

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > sendRequest > should throw error if SSE connection is not open
🔄 [SseMCPTransport] Connecting to SSE endpoint: http://localhost:3000/sse

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > sendRequest > should throw error if SSE connection is not open
✅ [SseMCPTransport] SSE connection opened for test-sse-server

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > sendRequest > should throw error if SSE connection is not open
✅ [SseMCPTransport] Initialized SSE transport for test-sse-server

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > sendRequest > should handle HTTP request failure
🔄 [SseMCPTransport] Connecting to SSE endpoint: http://localhost:3000/sse

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > sendRequest > should handle HTTP request failure
✅ [SseMCPTransport] SSE connection opened for test-sse-server

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > sendRequest > should handle HTTP request failure
✅ [SseMCPTransport] Initialized SSE transport for test-sse-server

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > sendRequest > should handle HTTP request failure
📡 [SseMCPTransport] Sending SSE request to test-sse-server: tools/list

stderr | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > sendRequest > should handle HTTP request failure
❌ [SseMCPTransport] Failed to send HTTP request to test-sse-server: Error: HTTP request failed
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/transport/mcp/sse-mcp-transport.test.ts:228:25
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > close > should close transport and clean up resources
🔄 [SseMCPTransport] Connecting to SSE endpoint: http://localhost:3000/sse

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > close > should close transport and clean up resources
✅ [SseMCPTransport] SSE connection opened for test-sse-server

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > close > should close transport and clean up resources
✅ [SseMCPTransport] Initialized SSE transport for test-sse-server

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > close > should close transport and clean up resources
🔄 [SseMCPTransport] SSE transport closed

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > close > should reject pending requests when closing
🔄 [SseMCPTransport] Connecting to SSE endpoint: http://localhost:3000/sse

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > close > should reject pending requests when closing
✅ [SseMCPTransport] SSE connection opened for test-sse-server

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > close > should reject pending requests when closing
✅ [SseMCPTransport] Initialized SSE transport for test-sse-server

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > close > should reject pending requests when closing
📡 [SseMCPTransport] Sending SSE request to test-sse-server: test
🔄 [SseMCPTransport] SSE transport closed

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > isConnected > should return true when connected
🔄 [SseMCPTransport] Connecting to SSE endpoint: http://localhost:3000/sse

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > isConnected > should return true when connected
✅ [SseMCPTransport] SSE connection opened for test-sse-server

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > isConnected > should return true when connected
✅ [SseMCPTransport] Initialized SSE transport for test-sse-server

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > isConnected > should return false when closed
🔄 [SseMCPTransport] Connecting to SSE endpoint: http://localhost:3000/sse

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > isConnected > should return false when closed
✅ [SseMCPTransport] SSE connection opened for test-sse-server

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > isConnected > should return false when closed
✅ [SseMCPTransport] Initialized SSE transport for test-sse-server

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > isConnected > should return false when closed
🔄 [SseMCPTransport] SSE transport closed

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > error handling > should handle malformed JSON responses
🔄 [SseMCPTransport] Connecting to SSE endpoint: http://localhost:3000/sse

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > error handling > should handle malformed JSON responses
✅ [SseMCPTransport] SSE connection opened for test-sse-server

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > error handling > should handle malformed JSON responses
✅ [SseMCPTransport] Initialized SSE transport for test-sse-server

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > error handling > should handle responses for unknown requests
🔄 [SseMCPTransport] Connecting to SSE endpoint: http://localhost:3000/sse

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > error handling > should handle responses for unknown requests
✅ [SseMCPTransport] SSE connection opened for test-sse-server

stdout | tests/transport/mcp/sse-mcp-transport.test.ts > SseMCPTransport > error handling > should handle responses for unknown requests
✅ [SseMCPTransport] Initialized SSE transport for test-sse-server

 ✓ tests/transport/mcp/sse-mcp-transport.test.ts (17 tests) 350ms
 ✓ tests/repository/provider-repository.test.ts (20 tests) 533ms
stdout | tests/integration/api-endpoints.test.ts > Integration Tests > GET /health > should return health check
[dotenv@17.2.0] injecting env (7) from .env (tip: 🔐 prevent committing .env to code: https://dotenvx.com/precommit)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > GET /health > should return health check
[dotenv@17.2.0] injecting env (0) from .env (tip: ⚙️  suppress all logs with { quiet: true })

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > GET /health > should return health check
[dotenv@17.2.0] injecting env (0) from .env (tip: 🔐 prevent committing .env to code: https://dotenvx.com/precommit)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > GET /health > should return health check
[dotenv@17.2.0] injecting env (0) from .env (tip: ⚙️  override existing env vars with { override: true })

stdout | tests/transport/agent/direct-agent-transport.test.ts > DirectAgentTransport > AgentClient Implementation > initialize > should handle MCP service initialization failure
🔄 [DirectAgentTransport] Initializing MCP service...

stdout | tests/transport/agent/direct-agent-transport.test.ts > DirectAgentTransport > AgentClient Implementation > callTool > should handle tool access validation failure
🛠️ [DirectAgentTransport] Calling tool: restricted-tool with args: {}

stdout | tests/transport/agent/direct-agent-transport.test.ts > DirectAgentTransport > AgentClient Implementation > callTool > should handle MCP error response
🛠️ [DirectAgentTransport] Calling tool: invalid-tool with args: {}

stdout | tests/transport/agent/direct-agent-transport.test.ts > DirectAgentTransport > AgentClient Implementation > callTool > should handle MCP service request failure
🛠️ [DirectAgentTransport] Calling tool: failing-tool with args: {}

stdout | tests/transport/agent/direct-agent-transport.test.ts > DirectAgentTransport > AgentClient Implementation > callTool > should handle complex tool parameters
🛠️ [DirectAgentTransport] Calling tool: complex-tool with args: {
  nested: { object: [32m'value'[39m },
  array: [ [33m1[39m, [33m2[39m, [33m3[39m ],
  boolean: [33mtrue[39m,
  number: [33m42[39m
}

stdout | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > initialize > should accept server config without headers
✅ [HttpMCPTransport] Initialized HTTP transport for test-http-server

stdout | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > initialize > should accept various valid URL formats
✅ [HttpMCPTransport] Initialized HTTP transport for test-http-server

stdout | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > initialize > should accept various valid URL formats
✅ [HttpMCPTransport] Initialized HTTP transport for test-http-server

stdout | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > initialize > should accept various valid URL formats
✅ [HttpMCPTransport] Initialized HTTP transport for test-http-server

 ✓ tests/transport/agent/direct-agent-transport.test.ts (12 tests) 94ms
stdout | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > initialize > should accept various valid URL formats
✅ [HttpMCPTransport] Initialized HTTP transport for test-http-server

stdout | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > sendRequest > should send request successfully and return response
✅ [HttpMCPTransport] Initialized HTTP transport for test-http-server

stdout | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > sendRequest > should handle HTTP request failure and return error response
✅ [HttpMCPTransport] Initialized HTTP transport for test-http-server

stdout | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > sendRequest > should handle HTTP request failure and return error response
📡 [HttpMCPTransport] Sending HTTP request to test-http-server: tools/call

stdout | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > sendRequest > should handle unknown error types
✅ [HttpMCPTransport] Initialized HTTP transport for test-http-server

stdout | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > sendRequest > should handle unknown error types
📡 [HttpMCPTransport] Sending HTTP request to test-http-server: ping

stderr | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > sendRequest > should handle unknown error types
❌ [HttpMCPTransport] HTTP request to test-http-server failed: String error

stdout | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > sendRequest > should throw error when not initialized
✅ [HttpMCPTransport] Initialized HTTP transport for test-http-server

stdout | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > sendRequest > should include server headers in request
✅ [HttpMCPTransport] Initialized HTTP transport for test-http-server

stdout | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > sendRequest > should include server headers in request
✅ [HttpMCPTransport] Initialized HTTP transport for test-http-server

stdout | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > sendRequest > should include server headers in request
📡 [HttpMCPTransport] Sending HTTP request to test-http-server: test

stdout | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > sendRequest > should include server headers in request
✅ [HttpMCPTransport] HTTP request to test-http-server successful

stdout | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > sendRequest > should work without server headers
✅ [HttpMCPTransport] Initialized HTTP transport for test-http-server

stdout | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > sendRequest > should work without server headers
✅ [HttpMCPTransport] Initialized HTTP transport for test-http-server

stdout | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > sendRequest > should work without server headers
📡 [HttpMCPTransport] Sending HTTP request to test-http-server: test

stdout | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > sendRequest > should work without server headers
✅ [HttpMCPTransport] HTTP request to test-http-server successful

stdout | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > close > should close transport successfully
✅ [HttpMCPTransport] Initialized HTTP transport for test-http-server

stdout | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > isConnected > should return true when initialized
✅ [HttpMCPTransport] Initialized HTTP transport for test-http-server

stdout | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > isConnected > should return false after close
✅ [HttpMCPTransport] Initialized HTTP transport for test-http-server

stdout | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > isConnected > should return false after close
🔄 [HttpMCPTransport] HTTP transport closed

stdout | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > getServerIdentifier > should return server identifier when initialized
✅ [HttpMCPTransport] Initialized HTTP transport for test-http-server

stdout | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > getServerIdentifier > should return unknown after close
✅ [HttpMCPTransport] Initialized HTTP transport for test-http-server

stdout | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > getServerIdentifier > should return unknown after close
🔄 [HttpMCPTransport] HTTP transport closed

stdout | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > error handling edge cases > should handle request with missing id
✅ [HttpMCPTransport] Initialized HTTP transport for test-http-server

stdout | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > error handling edge cases > should handle request with missing id
📡 [HttpMCPTransport] Sending HTTP request to test-http-server: test

stderr | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > error handling edge cases > should handle request with missing id
❌ [HttpMCPTransport] HTTP request to test-http-server failed: Error: Bad request
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/transport/mcp/http-mcp-transport.test.ts:375:25
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m

stdout | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > error handling edge cases > should handle complex error objects
✅ [HttpMCPTransport] Initialized HTTP transport for test-http-server

stdout | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > error handling edge cases > should handle complex error objects
📡 [HttpMCPTransport] Sending HTTP request to test-http-server: test

stderr | tests/transport/mcp/http-mcp-transport.test.ts > HttpMCPTransport > error handling edge cases > should handle complex error objects
❌ [HttpMCPTransport] HTTP request to test-http-server failed: {
  name: [32m'AxiosError'[39m,
  message: [32m'Request failed with status code 500'[39m,
  code: [32m'ERR_BAD_RESPONSE'[39m,
  config: {},
  request: {},
  response: { status: [33m500[39m }
}

 ✓ tests/utils/config-helper.test.ts (45 tests) 226ms
 ✓ tests/transport/mcp/http-mcp-transport.test.ts (22 tests) 185ms
stdout | tests/core/sse-agent-service.test.ts > SseAgentService > handleAgentConnection > should handle agent connection when transport is registered
🔄 [SseAgentService] Registered SSE transport for agent test-agent

stdout | tests/core/sse-agent-service.test.ts > SseAgentService > handleAgentResponse > should handle agent response when transport is registered
🔄 [SseAgentService] Registered SSE transport for agent test-agent

stdout | tests/core/sse-agent-service.test.ts > SseAgentService > isAgentConnected > should return true when agent is connected
🔄 [SseAgentService] Registered SSE transport for agent test-agent

stdout | tests/core/sse-agent-service.test.ts > SseAgentService > isAgentConnected > should return false when transport is registered but not connected
🔄 [SseAgentService] Registered SSE transport for agent test-agent

stdout | tests/core/sse-agent-service.test.ts > SseAgentService > getConnectedAgentIds > should return connected agent IDs
🔄 [SseAgentService] Registered SSE transport for agent agent1
🔄 [SseAgentService] Registered SSE transport for agent agent2

 ✓ tests/core/sse-agent-service.test.ts (13 tests) 40ms
stdout | tests/middleware/jwt-auth.test.ts > JWT Auth Middleware > createJWTMiddleware > should authenticate valid JWT token
✅ [JWT Auth] Token verified for user: user123

stderr | tests/middleware/jwt-auth.test.ts > JWT Auth Middleware > createJWTMiddleware > should return 401 when JWT verification fails
❌ [JWT Auth] Token verification failed: Error: JWT verification failed: invalid signature
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/middleware/jwt-auth.test.ts:113:9
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m

stderr | tests/middleware/jwt-auth.test.ts > JWT Auth Middleware > createJWTMiddleware > should return 401 with specific error for expired token
❌ [JWT Auth] Token verification failed: Error: JWT token has expired
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/middleware/jwt-auth.test.ts:130:51
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m

stderr | tests/middleware/jwt-auth.test.ts > JWT Auth Middleware > createJWTMiddleware > should return 401 with specific error for invalid token
❌ [JWT Auth] Token verification failed: Error: JWT token is invalid
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/middleware/jwt-auth.test.ts:146:51
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m

stderr | tests/middleware/jwt-auth.test.ts > JWT Auth Middleware > createJWTMiddleware > should return 401 with specific error for issuer mismatch
❌ [JWT Auth] Token verification failed: Error: JWT token issuer mismatch
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/middleware/jwt-auth.test.ts:162:51
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m

stderr | tests/middleware/jwt-auth.test.ts > JWT Auth Middleware > createJWTMiddleware > should return 401 with specific error for audience mismatch
❌ [JWT Auth] Token verification failed: Error: JWT token audience mismatch
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/middleware/jwt-auth.test.ts:178:51
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m

stdout | tests/middleware/jwt-auth.test.ts > JWT Auth Middleware > createOptionalJwtMiddleware > should authenticate when valid JWT token is provided
✅ [JWT Auth] Token verified for user: user123

stderr | tests/middleware/jwt-auth.test.ts > JWT Auth Middleware > createOptionalJwtMiddleware > should return 401 when invalid JWT token is provided
❌ [JWT Auth] Token verification failed: Error: JWT verification failed
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/middleware/jwt-auth.test.ts:228:51
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m

 ✓ tests/middleware/jwt-auth.test.ts (17 tests) 106ms
stdout | tests/transport/agent/http-agent-transport.test.ts > HttpAgentTransport > dispatch > should call agent successfully
🚀 [HttpAgentTransport] Calling agent at http://localhost:3000/agent

stdout | tests/transport/agent/http-agent-transport.test.ts > HttpAgentTransport > dispatch > should call agent successfully
✅ [HttpAgentTransport] Agent responded successfully

stdout | tests/transport/agent/http-agent-transport.test.ts > HttpAgentTransport > dispatch > should throw error for HTTP error status
🚀 [HttpAgentTransport] Calling agent at http://localhost:3000/agent

stderr | tests/transport/agent/http-agent-transport.test.ts > HttpAgentTransport > dispatch > should throw error for HTTP error status
❌ [HttpAgentTransport] Agent call failed: Error: Agent responded with status 500: Internal Server Error
    at HttpAgentTransport.validateHttpResponse [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/transport/agent/http-agent-transport.ts:76:13[90m)[39m
    at HttpAgentTransport.dispatch [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/transport/agent/http-agent-transport.ts:40:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/transport/agent/http-agent-transport.test.ts:94:7
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20

stdout | tests/transport/agent/http-agent-transport.test.ts > HttpAgentTransport > dispatch > should throw error for invalid response format
🚀 [HttpAgentTransport] Calling agent at http://localhost:3000/agent

stderr | tests/transport/agent/http-agent-transport.test.ts > HttpAgentTransport > dispatch > should throw error for invalid response format
❌ [HttpAgentTransport] Agent call failed: Error: Invalid agent response format: missing required fields (timestamp, type, content, metadata)
    at HttpAgentTransport.validateAgentResponse [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/transport/agent/http-agent-transport.ts:94:13[90m)[39m
    at HttpAgentTransport.dispatch [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/transport/agent/http-agent-transport.ts:41:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/transport/agent/http-agent-transport.test.ts:110:7
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20

stdout | tests/transport/agent/http-agent-transport.test.ts > HttpAgentTransport > dispatch > should propagate fetch errors
🚀 [HttpAgentTransport] Calling agent at http://localhost:3000/agent

stderr | tests/transport/agent/http-agent-transport.test.ts > HttpAgentTransport > dispatch > should propagate fetch errors
❌ [HttpAgentTransport] Agent call failed: Error: Network error
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/transport/agent/http-agent-transport.test.ts:116:26
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m

stdout | tests/transport/agent/http-agent-transport.test.ts > HttpAgentTransport > dispatch > should include JWT token in Authorization header when configured
🚀 [HttpAgentTransport] Calling agent at http://localhost:3000/agent

stdout | tests/transport/agent/http-agent-transport.test.ts > HttpAgentTransport > dispatch > should include JWT token in Authorization header when configured
✅ [HttpAgentTransport] Agent responded successfully

stdout | tests/transport/agent/http-agent-transport.test.ts > HttpAgentTransport > dispatch > should handle JWT token fetch errors
🚀 [HttpAgentTransport] Calling agent at http://localhost:3000/agent

stderr | tests/transport/agent/http-agent-transport.test.ts > HttpAgentTransport > dispatch > should handle JWT token fetch errors
❌ [HttpAgentTransport] Agent call failed: Error: Token fetch failed
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/transport/agent/http-agent-transport.test.ts:171:24
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m

stdout | tests/transport/agent/http-agent-transport.test.ts > HttpAgentTransport > dispatch > should not include Authorization header when no auth configured
🚀 [HttpAgentTransport] Calling agent at http://localhost:3000/agent

stdout | tests/transport/agent/http-agent-transport.test.ts > HttpAgentTransport > dispatch > should not include Authorization header when no auth configured
✅ [HttpAgentTransport] Agent responded successfully

 ✓ tests/transport/agent/http-agent-transport.test.ts (10 tests) 70ms
stdout | tests/integration/api-endpoints.test.ts > Integration Tests > GET /health > should return health check
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > GET /health > should return health check
🔧 [DispatchService] Created with MCP service and agent provider

stdout | tests/core/provider-mcp-service.test.ts
[dotenv@17.2.0] injecting env (10) from .env (tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' })

stdout | tests/core/provider-rest-service.test.ts
[dotenv@17.2.0] injecting env (10) from .env (tip: 🔐 prevent committing .env to code: https://dotenvx.com/precommit)

stdout | tests/utils/prompt-helper.test.ts > PromptHelper > loadPromptFromSource > should load from remote URL
📋 [PromptHelper] Loading test prompt from: https://example.com/prompt.md
🌐 [PromptHelper] Fetching test prompt from remote URL...

stdout | tests/utils/prompt-helper.test.ts > PromptHelper > loadPromptFromSource > should load from remote URL
✅ [PromptHelper] Successfully loaded test prompt from remote URL (39 characters)

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > initialization > should initialize successfully
🔄 [ProviderMCPService] Initializing MCP provider service...

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > initialization > should initialize successfully
🔄 [ProviderMCPService] Initializing MCP server: weather_service
✅ [HttpMCPTransport] Initialized HTTP transport for weather_service

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > initialization > should initialize successfully
📡 [HttpMCPTransport] Sending HTTP request to weather_service: initialize

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > initialization > should initialize successfully
✅ [HttpMCPTransport] HTTP request to weather_service successful

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > initialization > should initialize successfully
✅ [ProviderMCPService] MCP server weather_service initialized

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > initialization > should initialize successfully
🔄 [ProviderMCPService] Initializing MCP server: file_service
✅ [HttpMCPTransport] Initialized HTTP transport for file_service

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > initialization > should initialize successfully
📡 [HttpMCPTransport] Sending HTTP request to file_service: initialize

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > initialization > should initialize successfully
✅ [HttpMCPTransport] HTTP request to file_service successful

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > initialization > should initialize successfully
✅ [ProviderMCPService] MCP server file_service initialized

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > initialization > should initialize successfully
✅ [ProviderMCPService] MCP provider service initialized

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > initialization > should handle initialization failures gracefully
🔄 [ProviderMCPService] Initializing MCP provider service...

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > initialization > should handle initialization failures gracefully
🔄 [ProviderMCPService] Initializing MCP server: weather_service
✅ [HttpMCPTransport] Initialized HTTP transport for weather_service

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > initialization > should handle initialization failures gracefully
📡 [HttpMCPTransport] Sending HTTP request to weather_service: initialize

stderr | tests/core/provider-mcp-service.test.ts > ProviderMCPService > initialization > should handle initialization failures gracefully
❌ [HttpMCPTransport] HTTP request to weather_service failed: Error: Connection failed
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/core/provider-mcp-service.test.ts:151:35
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > initialization > should handle initialization failures gracefully
🔄 [ProviderMCPService] Initializing MCP server: file_service
✅ [HttpMCPTransport] Initialized HTTP transport for file_service

stderr | tests/core/provider-mcp-service.test.ts > ProviderMCPService > initialization > should handle initialization failures gracefully
⚠️ [ProviderMCPService] Failed to initialize MCP server weather_service: Error: MCP server initialization failed: MCP server initialization failed: HTTP request failed: Connection failed
    at ProviderMCPService.initializeMCPServer [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:189:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at ProviderMCPService.initialize [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:56:9[90m)[39m
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/core/provider-mcp-service.test.ts:154:7
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > initialization > should handle initialization failures gracefully
📡 [HttpMCPTransport] Sending HTTP request to file_service: initialize

stderr | tests/core/provider-mcp-service.test.ts > ProviderMCPService > initialization > should handle initialization failures gracefully
❌ [HttpMCPTransport] HTTP request to file_service failed: Error: Connection failed
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/core/provider-mcp-service.test.ts:151:35
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > initialization > should handle initialization failures gracefully
✅ [ProviderMCPService] MCP provider service initialized

stderr | tests/core/provider-mcp-service.test.ts > ProviderMCPService > initialization > should handle initialization failures gracefully
⚠️ [ProviderMCPService] Failed to initialize MCP server file_service: Error: MCP server initialization failed: MCP server initialization failed: HTTP request failed: Connection failed
    at ProviderMCPService.initializeMCPServer [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:189:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at ProviderMCPService.initialize [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:56:9[90m)[39m
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/core/provider-mcp-service.test.ts:154:7
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > MCP tools handling > should fetch tools from MCP server successfully via toolsList
🔧 [ProviderMCPService] Loading MCP tools from weather_service...
✅ [HttpMCPTransport] Initialized HTTP transport for weather_service

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > MCP tools handling > should fetch tools from MCP server successfully via toolsList
📡 [HttpMCPTransport] Sending HTTP request to weather_service: tools/list

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > MCP tools handling > should fetch tools from MCP server successfully via toolsList
✅ [HttpMCPTransport] HTTP request to weather_service successful

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > MCP tools handling > should fetch tools from MCP server successfully via toolsList
✅ [ProviderMCPService] Loaded 1 tools from MCP server weather_service
🔧 [ProviderMCPService] Loading MCP tools from file_service...
✅ [HttpMCPTransport] Initialized HTTP transport for file_service

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > MCP tools handling > should fetch tools from MCP server successfully via toolsList
📡 [HttpMCPTransport] Sending HTTP request to file_service: tools/list

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > MCP tools handling > should fetch tools from MCP server successfully via toolsList
✅ [HttpMCPTransport] HTTP request to file_service successful

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > MCP tools handling > should fetch tools from MCP server successfully via toolsList
✅ [ProviderMCPService] Loaded 1 tools from MCP server file_service

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > MCP tools handling > should handle MCP error responses via toolsList
🔧 [ProviderMCPService] Loading MCP tools from weather_service...
✅ [HttpMCPTransport] Initialized HTTP transport for weather_service

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > MCP tools handling > should handle MCP error responses via toolsList
📡 [HttpMCPTransport] Sending HTTP request to weather_service: tools/list

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > MCP tools handling > should handle MCP error responses via toolsList
✅ [HttpMCPTransport] HTTP request to weather_service successful

stderr | tests/core/provider-mcp-service.test.ts > ProviderMCPService > MCP tools handling > should handle MCP error responses via toolsList
⚠️ [ProviderMCPService] Failed to get MCP tools from weather_service: Error: MCP tools request failed: Method not found
    at ProviderMCPService.getMCPTools [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:266:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at ProviderMCPService.loadToolsFromServer [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:218:22[90m)[39m
    at ProviderMCPService.toolsList [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:85:23[90m)[39m
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/core/provider-mcp-service.test.ts:238:21
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > MCP tools handling > should handle MCP error responses via toolsList
🔧 [ProviderMCPService] Loading MCP tools from file_service...
✅ [HttpMCPTransport] Initialized HTTP transport for file_service

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > MCP tools handling > should handle MCP error responses via toolsList
📡 [HttpMCPTransport] Sending HTTP request to file_service: tools/list

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > MCP tools handling > should handle MCP error responses via toolsList
✅ [HttpMCPTransport] HTTP request to file_service successful

stdout | tests/utils/prompt-helper.test.ts > PromptHelper > loadPromptFromSource > should load from local file
📋 [PromptHelper] Loading test prompt from: ./prompt.md
📁 [PromptHelper] Loading test prompt from local file...
✅ [PromptHelper] Successfully loaded test prompt from local file (40 characters)

stdout | tests/utils/prompt-helper.test.ts > PromptHelper > loadPromptFromSource > should handle URL fetch errors
📋 [PromptHelper] Loading test prompt from: https://example.com/prompt.md
🌐 [PromptHelper] Fetching test prompt from remote URL...

stdout | tests/utils/prompt-helper.test.ts > PromptHelper > loadPromptFromSource > should handle file read errors
📋 [PromptHelper] Loading test prompt from: ./nonexistent.md
📁 [PromptHelper] Loading test prompt from local file...

stdout | tests/utils/prompt-helper.test.ts > PromptHelper > loadPromptFromSource > should handle HTTP error responses
📋 [PromptHelper] Loading test prompt from: https://example.com/prompt.md
🌐 [PromptHelper] Fetching test prompt from remote URL...

stdout | tests/utils/prompt-helper.test.ts > PromptHelper > loadPromptFromSource > should trim whitespace from content
📋 [PromptHelper] Loading test prompt from: ./prompt.md
📁 [PromptHelper] Loading test prompt from local file...
✅ [PromptHelper] Successfully loaded test prompt from local file (38 characters)

stdout | tests/utils/prompt-helper.test.ts > PromptHelper > loadPrompt > should load from source when value looks like a path
📋 [PromptHelper] Loading test prompt from: ./prompt.md
📁 [PromptHelper] Loading test prompt from local file...
✅ [PromptHelper] Successfully loaded test prompt from local file (30 characters)

stdout | tests/utils/prompt-helper.test.ts > PromptHelper > loadPrompt > should return inline content when value does not look like a path
📝 [PromptHelper] Using inline test prompt (57 characters)

stdout | tests/utils/prompt-helper.test.ts > PromptHelper > loadPrompt > should handle empty or null values
📝 [PromptHelper] Using inline test prompt (3 characters)

stdout | tests/utils/prompt-helper.test.ts > PromptHelper > loadPrompt > should detect and use inline content correctly
📝 [PromptHelper] Using inline test prompt (27 characters)

stdout | tests/utils/prompt-helper.test.ts > PromptHelper > loadPrompt > should detect and use inline content correctly
📝 [PromptHelper] Using inline test prompt (35 characters)

stdout | tests/utils/prompt-helper.test.ts > PromptHelper > loadPrompt > should detect and use inline content correctly
📝 [PromptHelper] Using inline test prompt (39 characters)

stdout | tests/utils/prompt-helper.test.ts > PromptHelper > loadPrompt > should detect and use inline content correctly
📝 [PromptHelper] Using inline test prompt (16 characters)

stdout | tests/utils/prompt-helper.test.ts > PromptHelper > loadPrompt > should detect and use inline content correctly
📝 [PromptHelper] Using inline test prompt (19 characters)

stdout | tests/utils/prompt-helper.test.ts > PromptHelper > loadPrompt > should detect and use inline content correctly
📝 [PromptHelper] Using inline test prompt (31 characters)

stdout | tests/utils/prompt-helper.test.ts > PromptHelper > loadPrompt > should detect and use inline content correctly
📝 [PromptHelper] Using inline test prompt (34 characters)

stdout | tests/utils/prompt-helper.test.ts > PromptHelper > loadPrompt > should trim inline content
📝 [PromptHelper] Using inline test prompt (38 characters)

stdout | tests/utils/prompt-helper.test.ts > PromptHelper > loadPrompt > should fallback to inline content when URL loading fails
📋 [PromptHelper] Loading test prompt from: https://example.com/nonexistent.md
🌐 [PromptHelper] Fetching test prompt from remote URL...

stderr | tests/utils/prompt-helper.test.ts > PromptHelper > loadPrompt > should fallback to inline content when URL loading fails
⚠️ [PromptHelper] Failed to load test prompt from source, treating as inline content: Failed to load test prompt from URL "https://example.com/nonexistent.md": Not found

stdout | tests/utils/prompt-helper.test.ts > PromptHelper > loadPrompt > should fallback to inline content when file loading fails
📋 [PromptHelper] Loading test prompt from: ./nonexistent.md
📁 [PromptHelper] Loading test prompt from local file...

stderr | tests/utils/prompt-helper.test.ts > PromptHelper > loadPrompt > should fallback to inline content when file loading fails
⚠️ [PromptHelper] Failed to load test prompt from source, treating as inline content: Failed to load test prompt from file "./nonexistent.md": File not found

stdout | tests/utils/prompt-helper.test.ts > PromptHelper > loadPrompt > should fallback to inline content for path-like strings that are actually prompts
📋 [PromptHelper] Loading test prompt from: ./some-config.md but actually this is a long prompt with instructions
📁 [PromptHelper] Loading test prompt from local file...

stderr | tests/utils/prompt-helper.test.ts > PromptHelper > loadPrompt > should fallback to inline content for path-like strings that are actually prompts
⚠️ [PromptHelper] Failed to load test prompt from source, treating as inline content: Failed to load test prompt from file "./some-config.md but actually this is a long prompt with instructions": File not found

 ✓ tests/utils/prompt-helper.test.ts (18 tests) 388ms
stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > toolsCall > should execute GET request with path parameters and query parameters
🌐 [RESTService] Executing REST tool: user_api.get_user

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > toolsCall > should execute GET request with path parameters and query parameters
🚀 [RESTService] Calling GET http://localhost:5000/api/users/123?include_profile=true

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > toolsCall > should execute GET request with path parameters and query parameters
✅ [RESTService] REST call successful

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > toolsCall > should execute POST request with payload
🌐 [RESTService] Executing REST tool: user_api.create_user

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > toolsCall > should execute POST request with payload
🚀 [RESTService] Calling POST http://localhost:5000/api/users

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > toolsCall > should execute POST request with payload
✅ [RESTService] REST call successful

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > toolsCall > should execute PUT request with path parameters, query parameters, and payload
🌐 [RESTService] Executing REST tool: user_api.update_user

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > toolsCall > should execute PUT request with path parameters, query parameters, and payload
🚀 [RESTService] Calling PUT http://localhost:5000/api/users/789/profile?notify=false

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > toolsCall > should execute PUT request with path parameters, query parameters, and payload
✅ [RESTService] REST call successful

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > toolsCall > should handle request without query parameters
🌐 [RESTService] Executing REST tool: user_api.get_user

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > toolsCall > should handle request without query parameters
🚀 [RESTService] Calling GET http://localhost:5000/api/users/123

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > toolsCall > should handle request without query parameters
✅ [RESTService] REST call successful

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > toolsCall > should throw error for non-existent endpoint
🌐 [RESTService] Executing REST tool: user_api.non_existent_function

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > toolsCall > should handle HTTP error responses
🌐 [RESTService] Executing REST tool: user_api.get_user

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > toolsCall > should handle HTTP error responses
🚀 [RESTService] Calling GET http://localhost:5000/api/users/123

stderr | tests/core/provider-rest-service.test.ts > ProviderRESTService > toolsCall > should handle HTTP error responses
❌ [RESTService] REST call failed: Error: REST call failed with status 404: Error
    at ProviderRESTService.executeHttpRequest [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-rest-service.ts:514:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at ProviderRESTService.executeRESTTool [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-rest-service.ts:286:24[90m)[39m
    at ProviderRESTService.toolsCall [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-rest-service.ts:98:12[90m)[39m
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/core/provider-rest-service.test.ts:345:7
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > toolsCall > should handle fetch rejection
🌐 [RESTService] Executing REST tool: user_api.get_user

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > toolsCall > should handle fetch rejection
🚀 [RESTService] Calling GET http://localhost:5000/api/users/123

stderr | tests/core/provider-rest-service.test.ts > ProviderRESTService > toolsCall > should handle fetch rejection
❌ [RESTService] REST call failed: Error: Network error
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/core/provider-rest-service.test.ts:351:28
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > toolsCall > should log REST call failure
🌐 [RESTService] Executing REST tool: user_api.get_user

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > toolsCall > should log REST call failure
🚀 [RESTService] Calling GET http://localhost:5000/api/users/123

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > canHandleRequest > should return true for valid REST server tool names
🔍 [ProviderRESTService] Checking if can handle: sft7he_get_user

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > canHandleRequest > should return true for valid REST server tool names
🔍 [ProviderRESTService] Can handle sft7he_get_user: true

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > canHandleRequest > should return false for invalid tool name format
🔍 [ProviderRESTService] Checking if can handle: invalidFormat
🔍 [ProviderRESTService] Error checking invalidFormat: Error: Invalid function name format: invalidFormat. Expected format: {hash}_{snake_case_function}

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > canHandleRequest > should return false for non-existent server
🔍 [ProviderRESTService] Checking if can handle: nonExistent_function
🔍 [ProviderRESTService] Error checking nonExistent_function: Error: Invalid function name format: nonExistent_function. Expected format: {hash}_{snake_case_function}

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > canHandleRequest > should return false for MCP server identifiers
🔍 [ProviderRESTService] Checking if can handle: mcpServer_function
🔍 [ProviderRESTService] Error checking mcpServer_function: Error: Invalid function name format: mcpServer_function. Expected format: {hash}_{snake_case_function}

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > complex parameter scenarios > should handle endpoints without path parameters
🌐 [RESTService] Executing REST tool: user_api.create_user

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > complex parameter scenarios > should handle endpoints without path parameters
🚀 [RESTService] Calling POST http://localhost:5000/api/users

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > complex parameter scenarios > should handle endpoints without path parameters
✅ [RESTService] REST call successful

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > complex parameter scenarios > should handle endpoints without query parameters
🌐 [RESTService] Executing REST tool: user_api.get_user

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > complex parameter scenarios > should handle endpoints without query parameters
🚀 [RESTService] Calling GET http://localhost:5000/api/users/123

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > complex parameter scenarios > should handle endpoints without query parameters
✅ [RESTService] REST call successful

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > complex parameter scenarios > should handle endpoints without payload
🌐 [RESTService] Executing REST tool: user_api.get_user

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > complex parameter scenarios > should handle endpoints without payload
🚀 [RESTService] Calling GET http://localhost:5000/api/users/123

stdout | tests/core/provider-rest-service.test.ts > ProviderRESTService > complex parameter scenarios > should handle endpoints without payload
✅ [RESTService] REST call successful

stderr | tests/core/provider-mcp-service.test.ts > ProviderMCPService > MCP tools handling > should handle MCP error responses via toolsList
⚠️ [ProviderMCPService] Failed to get MCP tools from file_service: Error: MCP tools request failed: Method not found
    at ProviderMCPService.getMCPTools [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:266:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at ProviderMCPService.loadToolsFromServer [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:218:22[90m)[39m
    at ProviderMCPService.toolsList [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:85:23[90m)[39m
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/core/provider-mcp-service.test.ts:238:21
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > MCP tools handling > should handle network errors via toolsList
🔧 [ProviderMCPService] Loading MCP tools from weather_service...
✅ [HttpMCPTransport] Initialized HTTP transport for weather_service

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > MCP tools handling > should handle network errors via toolsList
📡 [HttpMCPTransport] Sending HTTP request to weather_service: tools/list

stderr | tests/core/provider-mcp-service.test.ts > ProviderMCPService > MCP tools handling > should handle network errors via toolsList
❌ [HttpMCPTransport] HTTP request to weather_service failed: Error: Network error
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/core/provider-mcp-service.test.ts:243:35
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m

stderr | tests/core/provider-mcp-service.test.ts > ProviderMCPService > MCP tools handling > should handle network errors via toolsList
⚠️ [ProviderMCPService] Failed to get MCP tools from weather_service: Error: MCP tools request failed: HTTP request failed: Network error
    at ProviderMCPService.getMCPTools [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:266:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at ProviderMCPService.loadToolsFromServer [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:218:22[90m)[39m
    at ProviderMCPService.toolsList [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:85:23[90m)[39m
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/core/provider-mcp-service.test.ts:246:21
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > MCP tools handling > should handle network errors via toolsList
🔧 [ProviderMCPService] Loading MCP tools from file_service...
✅ [HttpMCPTransport] Initialized HTTP transport for file_service

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > MCP tools handling > should handle network errors via toolsList
📡 [HttpMCPTransport] Sending HTTP request to file_service: tools/list

stderr | tests/core/provider-mcp-service.test.ts > ProviderMCPService > MCP tools handling > should handle network errors via toolsList
❌ [HttpMCPTransport] HTTP request to file_service failed: Error: Network error
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/core/provider-mcp-service.test.ts:243:35
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m

stderr | tests/core/provider-mcp-service.test.ts > ProviderMCPService > MCP tools handling > should handle network errors via toolsList
⚠️ [ProviderMCPService] Failed to get MCP tools from file_service: Error: MCP tools request failed: HTTP request failed: Network error
    at ProviderMCPService.getMCPTools [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:266:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at ProviderMCPService.loadToolsFromServer [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:218:22[90m)[39m
    at ProviderMCPService.toolsList [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:85:23[90m)[39m
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/core/provider-mcp-service.test.ts:246:21
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > MCP tools handling > should return empty tools when no tools in response
🔧 [ProviderMCPService] Loading MCP tools from weather_service...
✅ [HttpMCPTransport] Initialized HTTP transport for weather_service

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > MCP tools handling > should return empty tools when no tools in response
📡 [HttpMCPTransport] Sending HTTP request to weather_service: tools/list

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > MCP tools handling > should return empty tools when no tools in response
✅ [HttpMCPTransport] HTTP request to weather_service successful

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > MCP tools handling > should return empty tools when no tools in response
✅ [ProviderMCPService] Loaded 0 tools from MCP server weather_service
🔧 [ProviderMCPService] Loading MCP tools from file_service...
✅ [HttpMCPTransport] Initialized HTTP transport for file_service

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > MCP tools handling > should return empty tools when no tools in response
📡 [HttpMCPTransport] Sending HTTP request to file_service: tools/list

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > MCP tools handling > should return empty tools when no tools in response
✅ [HttpMCPTransport] HTTP request to file_service successful

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > MCP tools handling > should return empty tools when no tools in response
✅ [ProviderMCPService] Loaded 0 tools from MCP server file_service

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsList - comprehensive testing > should fetch tools from all MCP servers
🔧 [ProviderMCPService] Loading MCP tools from weather_service...
✅ [HttpMCPTransport] Initialized HTTP transport for weather_service

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsList - comprehensive testing > should fetch tools from all MCP servers
📡 [HttpMCPTransport] Sending HTTP request to weather_service: tools/list

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsList - comprehensive testing > should fetch tools from all MCP servers
✅ [HttpMCPTransport] HTTP request to weather_service successful

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsList - comprehensive testing > should fetch tools from all MCP servers
✅ [ProviderMCPService] Loaded 1 tools from MCP server weather_service
🔧 [ProviderMCPService] Loading MCP tools from file_service...
✅ [HttpMCPTransport] Initialized HTTP transport for file_service

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsList - comprehensive testing > should fetch tools from all MCP servers
📡 [HttpMCPTransport] Sending HTTP request to file_service: tools/list

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsList - comprehensive testing > should fetch tools from all MCP servers
✅ [HttpMCPTransport] HTTP request to file_service successful

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsList - comprehensive testing > should fetch tools from all MCP servers
✅ [ProviderMCPService] Loaded 1 tools from MCP server file_service

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsList - comprehensive testing > should continue with other servers if one fails
🔧 [ProviderMCPService] Loading MCP tools from weather_service...
✅ [HttpMCPTransport] Initialized HTTP transport for weather_service

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsList - comprehensive testing > should continue with other servers if one fails
📡 [HttpMCPTransport] Sending HTTP request to weather_service: tools/list

stderr | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsList - comprehensive testing > should continue with other servers if one fails
❌ [HttpMCPTransport] HTTP request to weather_service failed: Error: Server down
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/core/provider-mcp-service.test.ts:309:39
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsList - comprehensive testing > should continue with other servers if one fails
🔧 [ProviderMCPService] Loading MCP tools from file_service...
✅ [HttpMCPTransport] Initialized HTTP transport for file_service

stderr | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsList - comprehensive testing > should continue with other servers if one fails
⚠️ [ProviderMCPService] Failed to get MCP tools from weather_service: Error: MCP tools request failed: HTTP request failed: Server down
    at ProviderMCPService.getMCPTools [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:266:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at ProviderMCPService.loadToolsFromServer [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:218:22[90m)[39m
    at ProviderMCPService.toolsList [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:85:23[90m)[39m
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/core/provider-mcp-service.test.ts:328:21
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsList - comprehensive testing > should continue with other servers if one fails
📡 [HttpMCPTransport] Sending HTTP request to file_service: tools/list

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsList - comprehensive testing > should continue with other servers if one fails
✅ [HttpMCPTransport] HTTP request to file_service successful

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsList - comprehensive testing > should continue with other servers if one fails
✅ [ProviderMCPService] Loaded 1 tools from MCP server file_service

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsList > should return all MCP tools via toolsList interface
🔧 [ProviderMCPService] Loading MCP tools from weather_service...
✅ [HttpMCPTransport] Initialized HTTP transport for weather_service

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsList > should return all MCP tools via toolsList interface
📡 [HttpMCPTransport] Sending HTTP request to weather_service: tools/list

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsList > should return all MCP tools via toolsList interface
✅ [HttpMCPTransport] HTTP request to weather_service successful

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsList > should return all MCP tools via toolsList interface
✅ [ProviderMCPService] Loaded 1 tools from MCP server weather_service
🔧 [ProviderMCPService] Loading MCP tools from file_service...
✅ [HttpMCPTransport] Initialized HTTP transport for file_service

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsList > should return all MCP tools via toolsList interface
📡 [HttpMCPTransport] Sending HTTP request to file_service: tools/list

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsList > should return all MCP tools via toolsList interface
✅ [HttpMCPTransport] HTTP request to file_service successful

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsList > should return all MCP tools via toolsList interface
✅ [ProviderMCPService] Loaded 1 tools from MCP server file_service

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsCall - MCP tool execution > should execute MCP tool successfully
⚙️ [ProviderMCPService] Executing MCP tool: 1r2dj4_get_weather

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsCall - MCP tool execution > should execute MCP tool successfully
✅ [HttpMCPTransport] Initialized HTTP transport for weather_service

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsCall - MCP tool execution > should execute MCP tool successfully
📡 [HttpMCPTransport] Sending HTTP request to weather_service: tools/call

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsCall - MCP tool execution > should execute MCP tool successfully
✅ [HttpMCPTransport] HTTP request to weather_service successful

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsCall - MCP tool execution > should handle MCP execution errors
⚙️ [ProviderMCPService] Executing MCP tool: 1r2dj4_get_weather

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsCall - MCP tool execution > should handle MCP execution errors
✅ [HttpMCPTransport] Initialized HTTP transport for weather_service

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsCall - MCP tool execution > should handle MCP execution errors
📡 [HttpMCPTransport] Sending HTTP request to weather_service: tools/call

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsCall - MCP tool execution > should handle MCP execution errors
✅ [HttpMCPTransport] HTTP request to weather_service successful

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsCall - MCP tool execution > should reject invalid tool name formats
⚙️ [ProviderMCPService] Executing MCP tool: invalid

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsCall - MCP tool execution > should reject invalid tool name formats
⚙️ [ProviderMCPService] Executing MCP tool: too_many_parts_here

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsCall - MCP tool execution > should reject invalid tool name formats
⚙️ [ProviderMCPService] Executing MCP tool: server_

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsCall > should execute tool via toolsCall interface
⚙️ [ProviderMCPService] Executing MCP tool: 1r2dj4_get_weather

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsCall > should execute tool via toolsCall interface
✅ [HttpMCPTransport] Initialized HTTP transport for weather_service

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsCall > should execute tool via toolsCall interface
📡 [HttpMCPTransport] Sending HTTP request to weather_service: tools/call

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > toolsCall > should execute tool via toolsCall interface
✅ [HttpMCPTransport] HTTP request to weather_service successful

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > edge cases > should use default empty schema when tool has no inputSchema
🔧 [ProviderMCPService] Loading MCP tools from weather_service...
✅ [HttpMCPTransport] Initialized HTTP transport for weather_service

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > edge cases > should use default empty schema when tool has no inputSchema
📡 [HttpMCPTransport] Sending HTTP request to weather_service: tools/list

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > edge cases > should use default empty schema when tool has no inputSchema
✅ [HttpMCPTransport] HTTP request to weather_service successful

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > edge cases > should use default empty schema when tool has no inputSchema
✅ [ProviderMCPService] Loaded 1 tools from MCP server weather_service
🔧 [ProviderMCPService] Loading MCP tools from file_service...
✅ [HttpMCPTransport] Initialized HTTP transport for file_service

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > edge cases > should use default empty schema when tool has no inputSchema
📡 [HttpMCPTransport] Sending HTTP request to file_service: tools/list

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > edge cases > should use default empty schema when tool has no inputSchema
✅ [HttpMCPTransport] HTTP request to file_service successful

stdout | tests/core/provider-mcp-service.test.ts > ProviderMCPService > edge cases > should use default empty schema when tool has no inputSchema
✅ [ProviderMCPService] Loaded 1 tools from MCP server file_service

 ✓ tests/core/provider-rest-service.test.ts (23 tests) 665ms
 ✓ tests/utils/jwt-helper.test.ts (23 tests) 955ms
stdout | tests/core/mcp-service.test.ts
[dotenv@17.2.0] injecting env (10) from .env (tip: 🔐 prevent committing .env to code: https://dotenvx.com/precommit)

 ✓ tests/core/provider-mcp-service.test.ts (21 tests) 496ms
stdout | tests/core/mcp-service.test.ts
[dotenv@17.2.0] injecting env (0) from .env (tip: ⚙️  suppress all logs with { quiet: true })

stdout | tests/core/mcp-service.test.ts
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/core/mcp-service.test.ts > MCP Service > constructor > should create service with providers
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/core/mcp-service.test.ts > MCP Service > constructor > should create service with providers
🔧 [MCPService] Created with 2 MCPCompatible providers

stdout | tests/core/mcp-service.test.ts > MCP Service > constructor > should create service with empty providers array
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/core/mcp-service.test.ts > MCP Service > constructor > should create service with empty providers array
🔧 [MCPService] Created with 0 MCPCompatible providers

stdout | tests/core/mcp-service.test.ts > MCP Service > constructor > should create service with default empty providers
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/core/mcp-service.test.ts > MCP Service > constructor > should create service with default empty providers
🔧 [MCPService] Created with 0 MCPCompatible providers

stdout | tests/core/mcp-service.test.ts > MCP Service > initialize > should initialize all providers successfully
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/core/mcp-service.test.ts > MCP Service > initialize > should initialize all providers successfully
🔧 [MCPService] Created with 3 MCPCompatible providers
🔄 [MCPService] Initializing all providers...

stdout | tests/core/mcp-service.test.ts > MCP Service > initialize > should initialize all providers successfully
✅ [MCPService] All providers initialized successfully

stdout | tests/core/mcp-service.test.ts > MCP Service > initialize > should throw error if provider initialization fails
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/core/mcp-service.test.ts > MCP Service > initialize > should throw error if provider initialization fails
🔧 [MCPService] Created with 2 MCPCompatible providers
🔄 [MCPService] Initializing all providers...

stderr | tests/core/mcp-service.test.ts > MCP Service > initialize > should throw error if provider initialization fails
❌ [MCPService] Failed to initialize providers: Error: Init failed
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/core/mcp-service.test.ts:115:9
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m

stdout | tests/core/mcp-service.test.ts > MCP Service > initialize > should handle empty providers array
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/core/mcp-service.test.ts > MCP Service > initialize > should handle empty providers array
🔧 [MCPService] Created with 0 MCPCompatible providers
🔄 [MCPService] Initializing all providers...
✅ [MCPService] All providers initialized successfully

stdout | tests/core/mcp-service.test.ts > MCP Service > handleMCPRequest > initialize method > should handle initialize request
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/core/mcp-service.test.ts > MCP Service > handleMCPRequest > initialize method > should handle initialize request
📡 [MCPService] Handling MCP request: initialize
🔄 [MCPService] Handling initialize request
🔄 [MCPService] Initializing all providers...

stdout | tests/core/mcp-service.test.ts > MCP Service > handleMCPRequest > initialize method > should handle initialize request
✅ [MCPService] All providers initialized successfully

stdout | tests/core/mcp-service.test.ts > MCP Service > handleMCPRequest > tools/list method > should return tools from all providers
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/core/mcp-service.test.ts > MCP Service > handleMCPRequest > tools/list method > should return tools from all providers
📡 [MCPService] Handling MCP request: tools/list
🔧 [MCPService] Handling tools/list request

stdout | tests/core/mcp-service.test.ts > MCP Service > handleMCPRequest > tools/list method > should return tools from all providers
✅ [MCPService] Returning 3 tools from 3 providers

stdout | tests/core/mcp-service.test.ts > MCP Service > handleMCPRequest > tools/list method > should handle provider error gracefully
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/core/mcp-service.test.ts > MCP Service > handleMCPRequest > tools/list method > should handle provider error gracefully
📡 [MCPService] Handling MCP request: tools/list
🔧 [MCPService] Handling tools/list request

stdout | tests/core/mcp-service.test.ts > MCP Service > handleMCPRequest > tools/list method > should return empty tools array when no providers
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/core/mcp-service.test.ts > MCP Service > handleMCPRequest > tools/list method > should return empty tools array when no providers
🔧 [MCPService] Created with 0 MCPCompatible providers
📡 [MCPService] Handling MCP request: tools/list
🔧 [MCPService] Handling tools/list request

stdout | tests/core/mcp-service.test.ts > MCP Service > handleMCPRequest > tools/list method > should return empty tools array when no providers
✅ [MCPService] Returning 0 tools from 0 providers

stdout | tests/core/mcp-service.test.ts > MCP Service > handleMCPRequest > tools/call method > should execute tool via appropriate provider
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/core/mcp-service.test.ts > MCP Service > handleMCPRequest > tools/call method > should execute tool via appropriate provider
📡 [MCPService] Handling MCP request: tools/call
⚙️ [MCPService] Handling tools/call request

stdout | tests/core/mcp-service.test.ts > MCP Service > handleMCPRequest > tools/call method > should handle string result from provider
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/core/mcp-service.test.ts > MCP Service > handleMCPRequest > tools/call method > should handle string result from provider
📡 [MCPService] Handling MCP request: tools/call
⚙️ [MCPService] Handling tools/call request

stdout | tests/core/mcp-service.test.ts > MCP Service > handleMCPRequest > tools/call method > should return error for missing tool name
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/core/mcp-service.test.ts > MCP Service > handleMCPRequest > tools/call method > should return error for missing tool name
📡 [MCPService] Handling MCP request: tools/call
⚙️ [MCPService] Handling tools/call request

stdout | tests/core/mcp-service.test.ts > MCP Service > handleMCPRequest > tools/call method > should return error for missing params
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/core/mcp-service.test.ts > MCP Service > handleMCPRequest > tools/call method > should return error for missing params
📡 [MCPService] Handling MCP request: tools/call
⚙️ [MCPService] Handling tools/call request

stdout | tests/core/mcp-service.test.ts > MCP Service > handleMCPRequest > tools/call method > should return error when no provider can handle tool
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/core/mcp-service.test.ts > MCP Service > handleMCPRequest > tools/call method > should return error when no provider can handle tool
📡 [MCPService] Handling MCP request: tools/call
⚙️ [MCPService] Handling tools/call request

stdout | tests/core/mcp-service.test.ts > MCP Service > handleMCPRequest > tools/call method > should handle provider execution error
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/core/mcp-service.test.ts > MCP Service > handleMCPRequest > tools/call method > should handle provider execution error
📡 [MCPService] Handling MCP request: tools/call
⚙️ [MCPService] Handling tools/call request

stdout | tests/core/mcp-service.test.ts > MCP Service > handleMCPRequest > tools/call method > should handle arguments parameter as empty object when missing
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/core/mcp-service.test.ts > MCP Service > handleMCPRequest > tools/call method > should handle arguments parameter as empty object when missing
📡 [MCPService] Handling MCP request: tools/call
⚙️ [MCPService] Handling tools/call request

stdout | tests/core/mcp-service.test.ts > MCP Service > handleMCPRequest > unsupported methods > should return method not found error for unsupported method
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/core/mcp-service.test.ts > MCP Service > handleMCPRequest > unsupported methods > should return method not found error for unsupported method
📡 [MCPService] Handling MCP request: unsupported/method

stdout | tests/transport/agent/direct-openai-agent-transport.test.ts > DirectOpenAIAgentTransport > dispatch > should use default config values when not provided
🤖 [DirectOpenAIAgentTransport] Creating OpenAI agent for dispatch

stdout | tests/transport/agent/direct-openai-agent-transport.test.ts > DirectOpenAIAgentTransport > dispatch > should use default config values when not provided
✅ [DirectOpenAIAgentTransport] OpenAI dispatch completed

stdout | tests/transport/agent/direct-openai-agent-transport.test.ts > DirectOpenAIAgentTransport > dispatch > should expand environment variables in apiKey
🤖 [DirectOpenAIAgentTransport] Creating OpenAI agent for dispatch

stdout | tests/transport/agent/direct-openai-agent-transport.test.ts > DirectOpenAIAgentTransport > dispatch > should expand environment variables in apiKey
✅ [DirectOpenAIAgentTransport] OpenAI dispatch completed

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > GET /agents > should return list of available agents
[dotenv@17.2.0] injecting env (7) from .env (tip: ⚙️  enable debug logging with { debug: true })

stdout | tests/transport/agent/direct-openai-agent-transport.test.ts > DirectOpenAIAgentTransport > dispatch > should handle OpenAI service dispatch failure
🤖 [DirectOpenAIAgentTransport] Creating OpenAI agent for dispatch

stdout | tests/core/mcp-service.test.ts > MCP Service > handleMCPRequest > error handling > should handle general errors in request processing
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/core/mcp-service.test.ts > MCP Service > handleMCPRequest > error handling > should handle general errors in request processing
🔧 [MCPService] Created with 1 MCPCompatible providers
📡 [MCPService] Handling MCP request: initialize
🔄 [MCPService] Handling initialize request
🔄 [MCPService] Initializing all providers...

stderr | tests/core/mcp-service.test.ts > MCP Service > handleMCPRequest > error handling > should handle general errors in request processing
❌ [MCPService] Failed to initialize providers: Error: Unexpected error
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/core/mcp-service.test.ts:415:11
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m

stderr | tests/core/mcp-service.test.ts > MCP Service > handleMCPRequest > error handling > should handle general errors in request processing
❌ [MCPService] Error handling MCP request: Error: Unexpected error
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/core/mcp-service.test.ts:415:11
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m

stdout | tests/core/mcp-service.test.ts > MCP Service > integration with actual service > should work with default export from mcp-service.js
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/transport/agent/direct-openai-agent-transport.test.ts > DirectOpenAIAgentTransport > dispatch > should create fresh CubicAgent instance for each dispatch
🤖 [DirectOpenAIAgentTransport] Creating OpenAI agent for dispatch

stdout | tests/transport/agent/direct-openai-agent-transport.test.ts > DirectOpenAIAgentTransport > dispatch > should create fresh CubicAgent instance for each dispatch
✅ [DirectOpenAIAgentTransport] OpenAI dispatch completed

stdout | tests/transport/agent/direct-openai-agent-transport.test.ts > DirectOpenAIAgentTransport > dispatch > should create fresh CubicAgent instance for each dispatch
🤖 [DirectOpenAIAgentTransport] Creating OpenAI agent for dispatch

stdout | tests/transport/agent/direct-openai-agent-transport.test.ts > DirectOpenAIAgentTransport > dispatch > should create fresh CubicAgent instance for each dispatch
✅ [DirectOpenAIAgentTransport] OpenAI dispatch completed

 ✓ tests/core/mcp-service.test.ts (20 tests) 223ms
stdout | tests/integration/api-endpoints.test.ts > Integration Tests > GET /agents > should return list of available agents
[dotenv@17.2.0] injecting env (0) from .env (tip: ⚙️  load multiple .env files with { path: ['.env.local', '.env'] })

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > GET /agents > should return list of available agents
[dotenv@17.2.0] injecting env (0) from .env (tip: 🔐 encrypt with dotenvx: https://dotenvx.com)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > GET /agents > should return list of available agents
[dotenv@17.2.0] injecting env (0) from .env (tip: ⚙️  suppress all logs with { quiet: true })

 ✓ tests/transport/agent/direct-openai-agent-transport.test.ts (18 tests) 236ms
stdout | tests/integration/api-endpoints.test.ts > Integration Tests > GET /agents > should return list of available agents
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > GET /agents > should return list of available agents
🔧 [DispatchService] Created with MCP service and agent provider

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > GET /agents > should return list of available agents
🤖 [Server] GET /agents - Fetching available agents
📋 [ConfigHelper] Loading agents configuration from: ./tests/mocks/test-agents.json
📁 [ConfigHelper] Loading from local file...
✅ [ConfigHelper] Successfully loaded agents configuration from local file
🔄 [ConfigHelper] Applied environment variable substitution to agents configuration

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > GET /agents > should return list of available agents
✅ [AgentRepository] Loaded 2 agents

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > GET /agents > should return list of available agents
✅ [Server] GET /agents - Success (2 agents)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch > should validate request body
[dotenv@17.2.0] injecting env (7) from .env (tip: ⚙️  enable debug logging with { debug: true })

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch > should validate request body
[dotenv@17.2.0] injecting env (0) from .env (tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' })

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch > should validate request body
[dotenv@17.2.0] injecting env (0) from .env (tip: ⚙️  load multiple .env files with { path: ['.env.local', '.env'] })

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch > should validate request body
[dotenv@17.2.0] injecting env (0) from .env (tip: ⚙️  enable debug logging with { debug: true })

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch > should validate request body
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch > should validate request body
🔧 [DispatchService] Created with MCP service and agent provider

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch > should validate request body
📨 [Server] POST /dispatch - Default agent dispatch with 0 messages
⚠️ [Server] POST /dispatch - Missing messages array

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch > should validate messages array
[dotenv@17.2.0] injecting env (7) from .env (tip: ⚙️  enable debug logging with { debug: true })

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch > should validate messages array
[dotenv@17.2.0] injecting env (0) from .env (tip: 🛠️  run anywhere with `dotenvx run -- yourcommand`)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch > should validate messages array
[dotenv@17.2.0] injecting env (0) from .env (tip: 🔐 prevent building .env in docker: https://dotenvx.com/prebuild)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch > should validate messages array
[dotenv@17.2.0] injecting env (0) from .env (tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' })

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch > should validate messages array
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch > should validate messages array
🔧 [DispatchService] Created with MCP service and agent provider

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch > should validate messages array
📨 [Server] POST /dispatch - Default agent dispatch with 0 messages
⚠️ [Server] POST /dispatch - Empty messages array

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch > should handle malformed message format
[dotenv@17.2.0] injecting env (7) from .env (tip: 🔐 prevent building .env in docker: https://dotenvx.com/prebuild)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch > should handle malformed message format
[dotenv@17.2.0] injecting env (0) from .env (tip: 🛠️  run anywhere with `dotenvx run -- yourcommand`)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch > should handle malformed message format
[dotenv@17.2.0] injecting env (0) from .env (tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' })

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch > should handle malformed message format
[dotenv@17.2.0] injecting env (0) from .env (tip: ⚙️  suppress all logs with { quiet: true })

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch > should handle malformed message format
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch > should handle malformed message format
🔧 [DispatchService] Created with MCP service and agent provider

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch > should handle malformed message format
📨 [Server] POST /dispatch - Default agent dispatch with 1 messages
⚠️ [Server] POST /dispatch - Invalid message format at index 0

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch/:agentId > should accept agent ID parameter
[dotenv@17.2.0] injecting env (7) from .env (tip: 🔐 prevent building .env in docker: https://dotenvx.com/prebuild)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch/:agentId > should accept agent ID parameter
[dotenv@17.2.0] injecting env (0) from .env (tip: 🔐 encrypt with dotenvx: https://dotenvx.com)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch/:agentId > should accept agent ID parameter
[dotenv@17.2.0] injecting env (0) from .env (tip: 🔐 prevent committing .env to code: https://dotenvx.com/precommit)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch/:agentId > should accept agent ID parameter
[dotenv@17.2.0] injecting env (0) from .env (tip: ⚙️  load multiple .env files with { path: ['.env.local', '.env'] })

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch/:agentId > should accept agent ID parameter
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch/:agentId > should accept agent ID parameter
🔧 [DispatchService] Created with MCP service and agent provider

 ✓ tests/utils/restriction-helper.test.ts (28 tests) 59ms
stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch/:agentId > should accept agent ID parameter
📨 [Server] POST /dispatch/gpt_4o - Specific agent dispatch with 1 messages
📨 [DispatchService] Dispatching to agent: gpt_4o
📋 [ConfigHelper] Loading agents configuration from: ./tests/mocks/test-agents.json
📁 [ConfigHelper] Loading from local file...
✅ [ConfigHelper] Successfully loaded agents configuration from local file
🔄 [ConfigHelper] Applied environment variable substitution to agents configuration
📋 [ConfigHelper] Loading agents configuration from: ./tests/mocks/test-agents.json
📁 [ConfigHelper] Loading from local file...
✅ [ConfigHelper] Successfully loaded agents configuration from local file
🔄 [ConfigHelper] Applied environment variable substitution to agents configuration
📋 [ConfigHelper] Loading agents configuration from: ./tests/mocks/test-agents.json
📁 [ConfigHelper] Loading from local file...
✅ [ConfigHelper] Successfully loaded agents configuration from local file
🔄 [ConfigHelper] Applied environment variable substitution to agents configuration
📡 [MCPService] Handling MCP request: tools/call
⚙️ [MCPService] Handling tools/call request
📡 [MCPService] Handling MCP request: tools/list
🔧 [MCPService] Handling tools/list request
✅ [AgentRepository] Loaded 2 agents
✅ [AgentRepository] Loaded 2 agents
✅ [AgentRepository] Loaded 2 agents
📋 [ConfigHelper] Loading providers configuration from: ./tests/mocks/test-providers.json
📁 [ConfigHelper] Loading from local file...
✅ [ConfigHelper] Successfully loaded providers configuration from local file
🔄 [ConfigHelper] Applied environment variable substitution to providers configuration
⚙️ [InternalToolsService] Executing internal tool: cubicler_available_servers
📋 [ConfigHelper] Loading providers configuration from: ./tests/mocks/test-providers.json
📁 [ConfigHelper] Loading from local file...
✅ [ConfigHelper] Successfully loaded providers configuration from local file
🔄 [ConfigHelper] Applied environment variable substitution to providers configuration
✅ [ProvidersRepository] Loaded 2 MCP servers and 1 REST servers
📝 [PromptHelper] Using inline base prompt (51 characters)
✅ [ProvidersRepository] Loaded 2 MCP servers and 1 REST servers
🔧 [ProviderMCPService] Loading MCP tools from weather_service...
✅ [HttpMCPTransport] Initialized HTTP transport for weather_service
📝 [PromptHelper] Using inline agent prompt for gpt_4o (49 characters)
🔄 [ProviderRepository] Config changed, updating server metadata...
✅ [ProviderRepository] Updated metadata for 3 servers
📡 [HttpMCPTransport] Sending HTTP request to weather_service: tools/list

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch/:agentId > should accept agent ID parameter
✅ [InternalToolsService] Found 3 servers

stderr | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch/:agentId > should accept agent ID parameter
❌ [HttpMCPTransport] HTTP request to weather_service failed: AxiosError [AggregateError]: 
    at AxiosError.from [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4maxios[24m/lib/core/AxiosError.js:92:14[90m)[39m
    at RedirectableRequest.handleRequestError [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4maxios[24m/lib/adapters/http.js:620:25[90m)[39m
[90m    at RedirectableRequest.emit (node:events:519:35)[39m
    at ClientRequest.eventHandlers.<computed> [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4mfollow-redirects[24m/index.js:49:24[90m)[39m
[90m    at ClientRequest.emit (node:events:507:28)[39m
[90m    at emitErrorEvent (node:_http_client:104:11)[39m
[90m    at Socket.socketErrorListener (node:_http_client:518:5)[39m
[90m    at Socket.emit (node:events:507:28)[39m
[90m    at emitErrorNT (node:internal/streams/destroy:170:8)[39m
[90m    at emitErrorCloseNT (node:internal/streams/destroy:129:3)[39m
    at Axios.request [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4maxios[24m/lib/core/Axios.js:45:41[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at axiosWithTimeout [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/utils/fetch-helper.ts:94:12[90m)[39m
    at HttpMCPTransport.sendRequest [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/transport/mcp/http-mcp-transport.ts:45:24[90m)[39m
    at ProviderMCPService.getMCPTools [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:263:22[90m)[39m
    at ProviderMCPService.loadToolsFromServer [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:218:22[90m)[39m
    at ProviderMCPService.toolsList [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:85:23[90m)[39m
    at MCPService.aggregateToolsFromProviders [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/mcp-service.ts:172:29[90m)[39m
    at MCPService.handleToolsList [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/mcp-service.ts:142:24[90m)[39m
    at MCPService.routeRequest [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/mcp-service.ts:74:16[90m)[39m {
  code: [32m'ECONNREFUSED'[39m,
  errors: [
    Error: connect ECONNREFUSED 127.0.0.1:4000
    [90m    at createConnectionError (node:net:1678:14)[39m
    [90m    at afterConnectMultiple (node:net:1708:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'127.0.0.1'[39m,
      port: [33m4000[39m
    },
    Error: connect ECONNREFUSED ::1:4000
    [90m    at createConnectionError (node:net:1678:14)[39m
    [90m    at afterConnectMultiple (node:net:1708:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'::1'[39m,
      port: [33m4000[39m
    }
  ],
  config: {
    transitional: {
      silentJSONParsing: [33mtrue[39m,
      forcedJSONParsing: [33mtrue[39m,
      clarifyTimeoutError: [33mfalse[39m
    },
    adapter: [ [32m'xhr'[39m, [32m'http'[39m, [32m'fetch'[39m ],
    transformRequest: [ [36m[Function: transformRequest][39m ],
    transformResponse: [ [36m[Function: transformResponse][39m ],
    timeout: [33m30000[39m,
    xsrfCookieName: [32m'XSRF-TOKEN'[39m,
    xsrfHeaderName: [32m'X-XSRF-TOKEN'[39m,
    maxContentLength: [33m-1[39m,
    maxBodyLength: [33m-1[39m,
    env: { FormData: [36m[Function [FormData]][39m, Blob: [36m[class Blob][39m },
    validateStatus: [36m[Function: validateStatus][39m,
    headers: Object [AxiosHeaders] {
      Accept: [32m'application/json, text/plain, */*'[39m,
      [32m'Content-Type'[39m: [32m'application/json'[39m,
      Authorization: [32m'Bearer test-token'[39m,
      [32m'User-Agent'[39m: [32m'axios/1.11.0'[39m,
      [32m'Content-Length'[39m: [32m'72'[39m,
      [32m'Accept-Encoding'[39m: [32m'gzip, compress, deflate, br'[39m
    },
    method: [32m'post'[39m,
    data: [32m'{"jsonrpc":"2.0","id":"tools-request","method":"tools/list","params":{}}'[39m,
    url: [32m'http://localhost:4000/mcp'[39m,
    allowAbsoluteUrls: [33mtrue[39m
  },
  request: [36m<ref *1>[39m Writable {
    _events: {
      close: [90mundefined[39m,
      error: [36m[Function: handleRequestError][39m,
      prefinish: [90mundefined[39m,
      finish: [90mundefined[39m,
      drain: [90mundefined[39m,
      response: [36m[Function: handleResponse][39m,
      socket: [36m[Array][39m,
      timeout: [90mundefined[39m,
      abort: [90mundefined[39m
    },
    _writableState: WritableState {
      highWaterMark: [33m65536[39m,
      length: [33m0[39m,
      corked: [33m0[39m,
      onwrite: [36m[Function: bound onwrite][39m,
      writelen: [33m0[39m,
      bufferedIndex: [33m0[39m,
      pendingcb: [33m0[39m,
      [32mSymbol(kState)[39m: [33m17580812[39m,
      [32mSymbol(kBufferedValue)[39m: [1mnull[22m
    },
    _maxListeners: [90mundefined[39m,
    _options: {
      maxRedirects: [33m21[39m,
      maxBodyLength: [33mInfinity[39m,
      protocol: [32m'http:'[39m,
      path: [32m'/mcp'[39m,
      method: [32m'POST'[39m,
      headers: [36m[Object: null prototype][39m,
      agents: [36m[Object][39m,
      auth: [90mundefined[39m,
      family: [90mundefined[39m,
      beforeRedirect: [36m[Function: dispatchBeforeRedirect][39m,
      beforeRedirects: [36m[Object][39m,
      hostname: [32m'localhost'[39m,
      port: [32m'4000'[39m,
      agent: [90mundefined[39m,
      nativeProtocols: [36m[Object][39m,
      pathname: [32m'/mcp'[39m
    },
    _ended: [33mfalse[39m,
    _ending: [33mtrue[39m,
    _redirectCount: [33m0[39m,
    _redirects: [],
    _requestBodyLength: [33m72[39m,
    _requestBodyBuffers: [ [36m[Object][39m ],
    _eventsCount: [33m3[39m,
    _onNativeResponse: [36m[Function (anonymous)][39m,
    _currentRequest: ClientRequest {
      _events: [36m[Object: null prototype][39m,
      _eventsCount: [33m7[39m,
      _maxListeners: [90mundefined[39m,
      outputData: [],
      outputSize: [33m0[39m,
      writable: [33mtrue[39m,
      destroyed: [33mfalse[39m,
      _last: [33mfalse[39m,
      chunkedEncoding: [33mfalse[39m,
      shouldKeepAlive: [33mtrue[39m,
      maxRequestsOnConnectionReached: [33mfalse[39m,
      _defaultKeepAlive: [33mtrue[39m,
      useChunkedEncodingByDefault: [33mtrue[39m,
      sendDate: [33mfalse[39m,
      _removedConnection: [33mfalse[39m,
      _removedContLen: [33mfalse[39m,
      _removedTE: [33mfalse[39m,
      strictContentLength: [33mfalse[39m,
      _contentLength: [33m72[39m,
      _hasBody: [33mtrue[39m,
      _trailer: [32m''[39m,
      finished: [33mfalse[39m,
      _headerSent: [33mtrue[39m,
      _closed: [33mfalse[39m,
      _header: [32m'POST /mcp HTTP/1.1\r\n'[39m +
        [32m'Accept: application/json, text/plain, */*\r\n'[39m +
        [32m'Content-Type: application/json\r\n'[39m +
        [32m'Authorization: Bearer test-token\r\n'[39m +
        [32m'User-Agent: axios/1.11.0\r\n'[39m +
        [32m'Content-Length: 72\r\n'[39m +
        [32m'Accept-Encoding: gzip, compress, deflate, br\r\n'[39m +
        [32m'Host: localhost:4000\r\n'[39m +
        [32m'Connection: keep-alive\r\n'[39m +
        [32m'\r\n'[39m,
      _keepAliveTimeout: [33m0[39m,
      _onPendingData: [36m[Function: nop][39m,
      agent: [36m[Agent][39m,
      socketPath: [90mundefined[39m,
      method: [32m'POST'[39m,
      maxHeaderSize: [90mundefined[39m,
      insecureHTTPParser: [90mundefined[39m,
      joinDuplicateHeaders: [90mundefined[39m,
      path: [32m'/mcp'[39m,
      _ended: [33mfalse[39m,
      res: [1mnull[22m,
      aborted: [33mfalse[39m,
      timeoutCb: [36m[Function: emitRequestTimeout][39m,
      upgradeOrConnect: [33mfalse[39m,
      parser: [1mnull[22m,
      maxHeadersCount: [1mnull[22m,
      reusedSocket: [33mfalse[39m,
      host: [32m'localhost'[39m,
      protocol: [32m'http:'[39m,
      _redirectable: [36m[Circular *1][39m,
      [32mSymbol(shapeMode)[39m: [33mfalse[39m,
      [32mSymbol(kCapture)[39m: [33mfalse[39m,
      [32mSymbol(kBytesWritten)[39m: [33m0[39m,
      [32mSymbol(kNeedDrain)[39m: [33mfalse[39m,
      [32mSymbol(corked)[39m: [33m0[39m,
      [32mSymbol(kChunkedBuffer)[39m: [],
      [32mSymbol(kChunkedLength)[39m: [33m0[39m,
      [32mSymbol(kSocket)[39m: [36m[Socket][39m,
      [32mSymbol(kOutHeaders)[39m: [36m[Object: null prototype][39m,
      [32mSymbol(errored)[39m: [1mnull[22m,
      [32mSymbol(kHighWaterMark)[39m: [33m65536[39m,
      [32mSymbol(kRejectNonStandardBodyWrites)[39m: [33mfalse[39m,
      [32mSymbol(kUniqueHeaders)[39m: [1mnull[22m
    },
    _currentUrl: [32m'http://localhost:4000/mcp'[39m,
    _timeout: [1mnull[22m,
    [32mSymbol(shapeMode)[39m: [33mtrue[39m,
    [32mSymbol(kCapture)[39m: [33mfalse[39m
  },
  cause: AggregateError: 
  [90m    at internalConnectMultiple (node:net:1134:18)[39m
  [90m    at afterConnectMultiple (node:net:1715:7)[39m {
    code: [32m'ECONNREFUSED'[39m,
    [errors]: [ [36m[Error][39m, [36m[Error][39m ]
  }
}

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch/:agentId > should accept agent ID parameter
🔧 [ProviderMCPService] Loading MCP tools from file_service...
✅ [HttpMCPTransport] Initialized HTTP transport for file_service

stderr | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch/:agentId > should accept agent ID parameter
⚠️ [ProviderMCPService] Failed to get MCP tools from weather_service: Error: MCP tools request failed: HTTP request failed: 
    at ProviderMCPService.getMCPTools [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:266:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at ProviderMCPService.loadToolsFromServer [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:218:22[90m)[39m
    at ProviderMCPService.toolsList [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:85:23[90m)[39m
    at MCPService.aggregateToolsFromProviders [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/mcp-service.ts:172:29[90m)[39m
    at MCPService.handleToolsList [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/mcp-service.ts:142:24[90m)[39m
    at MCPService.routeRequest [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/mcp-service.ts:74:16[90m)[39m
    at MCPService.handleMCPRequest [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/mcp-service.ts:51:14[90m)[39m
    at async Promise.all (index 4)
    at DispatchService.gatherAgentData [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/dispatch-service.ts:117:63[90m)[39m

stdout | tests/core/dispatch-service.test.ts
[dotenv@17.2.0] injecting env (10) from .env (tip: ⚙️  write to custom object with { processEnv: myObject })

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch/:agentId > should accept agent ID parameter
📡 [HttpMCPTransport] Sending HTTP request to file_service: tools/list

stderr | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch/:agentId > should accept agent ID parameter
❌ [HttpMCPTransport] HTTP request to file_service failed: AxiosError [AggregateError]: 
    at AxiosError.from [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4maxios[24m/lib/core/AxiosError.js:92:14[90m)[39m
    at RedirectableRequest.handleRequestError [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4maxios[24m/lib/adapters/http.js:620:25[90m)[39m
[90m    at RedirectableRequest.emit (node:events:519:35)[39m
    at ClientRequest.eventHandlers.<computed> [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4mfollow-redirects[24m/index.js:49:24[90m)[39m
[90m    at ClientRequest.emit (node:events:507:28)[39m
[90m    at emitErrorEvent (node:_http_client:104:11)[39m
[90m    at Socket.socketErrorListener (node:_http_client:518:5)[39m
[90m    at Socket.emit (node:events:507:28)[39m
[90m    at emitErrorNT (node:internal/streams/destroy:170:8)[39m
[90m    at emitErrorCloseNT (node:internal/streams/destroy:129:3)[39m
    at Axios.request [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4maxios[24m/lib/core/Axios.js:45:41[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at axiosWithTimeout [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/utils/fetch-helper.ts:94:12[90m)[39m
    at HttpMCPTransport.sendRequest [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/transport/mcp/http-mcp-transport.ts:45:24[90m)[39m
    at ProviderMCPService.getMCPTools [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:263:22[90m)[39m
    at ProviderMCPService.loadToolsFromServer [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:218:22[90m)[39m
    at ProviderMCPService.toolsList [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:85:23[90m)[39m
    at MCPService.aggregateToolsFromProviders [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/mcp-service.ts:172:29[90m)[39m
    at MCPService.handleToolsList [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/mcp-service.ts:142:24[90m)[39m
    at MCPService.routeRequest [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/mcp-service.ts:74:16[90m)[39m {
  code: [32m'ECONNREFUSED'[39m,
  errors: [
    Error: connect ECONNREFUSED 127.0.0.1:4001
    [90m    at createConnectionError (node:net:1678:14)[39m
    [90m    at afterConnectMultiple (node:net:1708:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'127.0.0.1'[39m,
      port: [33m4001[39m
    },
    Error: connect ECONNREFUSED ::1:4001
    [90m    at createConnectionError (node:net:1678:14)[39m
    [90m    at afterConnectMultiple (node:net:1708:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'::1'[39m,
      port: [33m4001[39m
    }
  ],
  config: {
    transitional: {
      silentJSONParsing: [33mtrue[39m,
      forcedJSONParsing: [33mtrue[39m,
      clarifyTimeoutError: [33mfalse[39m
    },
    adapter: [ [32m'xhr'[39m, [32m'http'[39m, [32m'fetch'[39m ],
    transformRequest: [ [36m[Function: transformRequest][39m ],
    transformResponse: [ [36m[Function: transformResponse][39m ],
    timeout: [33m30000[39m,
    xsrfCookieName: [32m'XSRF-TOKEN'[39m,
    xsrfHeaderName: [32m'X-XSRF-TOKEN'[39m,
    maxContentLength: [33m-1[39m,
    maxBodyLength: [33m-1[39m,
    env: { FormData: [36m[Function [FormData]][39m, Blob: [36m[class Blob][39m },
    validateStatus: [36m[Function: validateStatus][39m,
    headers: Object [AxiosHeaders] {
      Accept: [32m'application/json, text/plain, */*'[39m,
      [32m'Content-Type'[39m: [32m'application/json'[39m,
      [32m'User-Agent'[39m: [32m'axios/1.11.0'[39m,
      [32m'Content-Length'[39m: [32m'72'[39m,
      [32m'Accept-Encoding'[39m: [32m'gzip, compress, deflate, br'[39m
    },
    method: [32m'post'[39m,
    data: [32m'{"jsonrpc":"2.0","id":"tools-request","method":"tools/list","params":{}}'[39m,
    url: [32m'http://localhost:4001/mcp'[39m,
    allowAbsoluteUrls: [33mtrue[39m
  },
  request: [36m<ref *1>[39m Writable {
    _events: {
      close: [90mundefined[39m,
      error: [36m[Function: handleRequestError][39m,
      prefinish: [90mundefined[39m,
      finish: [90mundefined[39m,
      drain: [90mundefined[39m,
      response: [36m[Function: handleResponse][39m,
      socket: [36m[Array][39m,
      timeout: [90mundefined[39m,
      abort: [90mundefined[39m
    },
    _writableState: WritableState {
      highWaterMark: [33m65536[39m,
      length: [33m0[39m,
      corked: [33m0[39m,
      onwrite: [36m[Function: bound onwrite][39m,
      writelen: [33m0[39m,
      bufferedIndex: [33m0[39m,
      pendingcb: [33m0[39m,
      [32mSymbol(kState)[39m: [33m17580812[39m,
      [32mSymbol(kBufferedValue)[39m: [1mnull[22m
    },
    _maxListeners: [90mundefined[39m,
    _options: {
      maxRedirects: [33m21[39m,
      maxBodyLength: [33mInfinity[39m,
      protocol: [32m'http:'[39m,
      path: [32m'/mcp'[39m,
      method: [32m'POST'[39m,
      headers: [36m[Object: null prototype][39m,
      agents: [36m[Object][39m,
      auth: [90mundefined[39m,
      family: [90mundefined[39m,
      beforeRedirect: [36m[Function: dispatchBeforeRedirect][39m,
      beforeRedirects: [36m[Object][39m,
      hostname: [32m'localhost'[39m,
      port: [32m'4001'[39m,
      agent: [90mundefined[39m,
      nativeProtocols: [36m[Object][39m,
      pathname: [32m'/mcp'[39m
    },
    _ended: [33mfalse[39m,
    _ending: [33mtrue[39m,
    _redirectCount: [33m0[39m,
    _redirects: [],
    _requestBodyLength: [33m72[39m,
    _requestBodyBuffers: [ [36m[Object][39m ],
    _eventsCount: [33m3[39m,
    _onNativeResponse: [36m[Function (anonymous)][39m,
    _currentRequest: ClientRequest {
      _events: [36m[Object: null prototype][39m,
      _eventsCount: [33m7[39m,
      _maxListeners: [90mundefined[39m,
      outputData: [],
      outputSize: [33m0[39m,
      writable: [33mtrue[39m,
      destroyed: [33mfalse[39m,
      _last: [33mfalse[39m,
      chunkedEncoding: [33mfalse[39m,
      shouldKeepAlive: [33mtrue[39m,
      maxRequestsOnConnectionReached: [33mfalse[39m,
      _defaultKeepAlive: [33mtrue[39m,
      useChunkedEncodingByDefault: [33mtrue[39m,
      sendDate: [33mfalse[39m,
      _removedConnection: [33mfalse[39m,
      _removedContLen: [33mfalse[39m,
      _removedTE: [33mfalse[39m,
      strictContentLength: [33mfalse[39m,
      _contentLength: [33m72[39m,
      _hasBody: [33mtrue[39m,
      _trailer: [32m''[39m,
      finished: [33mfalse[39m,
      _headerSent: [33mtrue[39m,
      _closed: [33mfalse[39m,
      _header: [32m'POST /mcp HTTP/1.1\r\n'[39m +
        [32m'Accept: application/json, text/plain, */*\r\n'[39m +
        [32m'Content-Type: application/json\r\n'[39m +
        [32m'User-Agent: axios/1.11.0\r\n'[39m +
        [32m'Content-Length: 72\r\n'[39m +
        [32m'Accept-Encoding: gzip, compress, deflate, br\r\n'[39m +
        [32m'Host: localhost:4001\r\n'[39m +
        [32m'Connection: keep-alive\r\n'[39m +
        [32m'\r\n'[39m,
      _keepAliveTimeout: [33m0[39m,
      _onPendingData: [36m[Function: nop][39m,
      agent: [36m[Agent][39m,
      socketPath: [90mundefined[39m,
      method: [32m'POST'[39m,
      maxHeaderSize: [90mundefined[39m,
      insecureHTTPParser: [90mundefined[39m,
      joinDuplicateHeaders: [90mundefined[39m,
      path: [32m'/mcp'[39m,
      _ended: [33mfalse[39m,
      res: [1mnull[22m,
      aborted: [33mfalse[39m,
      timeoutCb: [36m[Function: emitRequestTimeout][39m,
      upgradeOrConnect: [33mfalse[39m,
      parser: [1mnull[22m,
      maxHeadersCount: [1mnull[22m,
      reusedSocket: [33mfalse[39m,
      host: [32m'localhost'[39m,
      protocol: [32m'http:'[39m,
      _redirectable: [36m[Circular *1][39m,
      [32mSymbol(shapeMode)[39m: [33mfalse[39m,
      [32mSymbol(kCapture)[39m: [33mfalse[39m,
      [32mSymbol(kBytesWritten)[39m: [33m0[39m,
      [32mSymbol(kNeedDrain)[39m: [33mfalse[39m,
      [32mSymbol(corked)[39m: [33m0[39m,
      [32mSymbol(kChunkedBuffer)[39m: [],
      [32mSymbol(kChunkedLength)[39m: [33m0[39m,
      [32mSymbol(kSocket)[39m: [36m[Socket][39m,
      [32mSymbol(kOutHeaders)[39m: [36m[Object: null prototype][39m,
      [32mSymbol(errored)[39m: [1mnull[22m,
      [32mSymbol(kHighWaterMark)[39m: [33m65536[39m,
      [32mSymbol(kRejectNonStandardBodyWrites)[39m: [33mfalse[39m,
      [32mSymbol(kUniqueHeaders)[39m: [1mnull[22m
    },
    _currentUrl: [32m'http://localhost:4001/mcp'[39m,
    _timeout: [1mnull[22m,
    [32mSymbol(shapeMode)[39m: [33mtrue[39m,
    [32mSymbol(kCapture)[39m: [33mfalse[39m
  },
  cause: AggregateError: 
  [90m    at internalConnectMultiple (node:net:1134:18)[39m
  [90m    at afterConnectMultiple (node:net:1715:7)[39m {
    code: [32m'ECONNREFUSED'[39m,
    [errors]: [ [36m[Error][39m, [36m[Error][39m ]
  }
}

stderr | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch/:agentId > should accept agent ID parameter
⚠️ [ProviderMCPService] Failed to get MCP tools from file_service: Error: MCP tools request failed: HTTP request failed: 
    at ProviderMCPService.getMCPTools [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:266:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at ProviderMCPService.loadToolsFromServer [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:218:22[90m)[39m
    at ProviderMCPService.toolsList [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:85:23[90m)[39m
    at MCPService.aggregateToolsFromProviders [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/mcp-service.ts:172:29[90m)[39m
    at MCPService.handleToolsList [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/mcp-service.ts:142:24[90m)[39m
    at MCPService.routeRequest [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/mcp-service.ts:74:16[90m)[39m
    at MCPService.handleMCPRequest [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/mcp-service.ts:51:14[90m)[39m
    at async Promise.all (index 4)
    at DispatchService.gatherAgentData [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/dispatch-service.ts:117:63[90m)[39m

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch/:agentId > should accept agent ID parameter
✅ [MCPService] Returning 4 tools from 3 providers

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch/:agentId > should accept agent ID parameter
🚀 [DispatchService] Calling agent GPT-4O Agent via http
🚀 [HttpAgentTransport] Calling agent at http://localhost:3000/agent

stdout | tests/core/internal-tools-service.test.ts
[dotenv@17.2.0] injecting env (10) from .env (tip: 🔐 prevent building .env in docker: https://dotenvx.com/prebuild)

stdout | tests/core/dispatch-service.test.ts
[dotenv@17.2.0] injecting env (0) from .env (tip: ⚙️  enable debug logging with { debug: true })

stdout | tests/core/dispatch-service.test.ts
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/core/dispatch-service.test.ts
[dotenv@17.2.0] injecting env (0) from .env (tip: 🔐 prevent building .env in docker: https://dotenvx.com/prebuild)

stdout | tests/core/dispatch-service.test.ts
[dotenv@17.2.0] injecting env (0) from .env (tip: 🔐 encrypt with dotenvx: https://dotenvx.com)

stdout | tests/core/dispatch-service.test.ts
🔧 [DispatchService] Created with MCP service and agent provider

 ✓ tests/utils/config-env-substitution.test.ts (3 tests) 80ms
stdout | tests/core/dispatch-service.test.ts > Dispatch Service > dispatch > should dispatch message to default agent
🔧 [DispatchService] Created with MCP service and agent provider

stdout | tests/core/dispatch-service.test.ts > Dispatch Service > dispatch > should dispatch message to default agent
📨 [DispatchService] Dispatching to agent: default

stdout | tests/core/dispatch-service.test.ts > Dispatch Service > dispatch > should dispatch message to default agent
🚀 [DispatchService] Calling agent GPT-4O Agent via http

stdout | tests/core/dispatch-service.test.ts > Dispatch Service > dispatch > should dispatch message to default agent
✅ [DispatchService] Agent GPT-4O Agent responded successfully

stderr | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch/:agentId > should accept agent ID parameter
❌ [HttpAgentTransport] Agent call failed: AxiosError [AggregateError]: 
    at AxiosError.from [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4maxios[24m/lib/core/AxiosError.js:92:14[90m)[39m
    at RedirectableRequest.handleRequestError [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4maxios[24m/lib/adapters/http.js:620:25[90m)[39m
[90m    at RedirectableRequest.emit (node:events:519:35)[39m
    at ClientRequest.eventHandlers.<computed> [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4mfollow-redirects[24m/index.js:49:24[90m)[39m
[90m    at ClientRequest.emit (node:events:507:28)[39m
[90m    at emitErrorEvent (node:_http_client:104:11)[39m
[90m    at Socket.socketErrorListener (node:_http_client:518:5)[39m
[90m    at Socket.emit (node:events:507:28)[39m
[90m    at emitErrorNT (node:internal/streams/destroy:170:8)[39m
[90m    at emitErrorCloseNT (node:internal/streams/destroy:129:3)[39m
    at Axios.request [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4maxios[24m/lib/core/Axios.js:45:41[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at axiosWithTimeout [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/utils/fetch-helper.ts:94:12[90m)[39m
    at HttpAgentTransport.dispatch [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/transport/agent/http-agent-transport.ts:34:24[90m)[39m
    at DispatchService.callAgent [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/dispatch-service.ts:108:12[90m)[39m
    at DispatchService.dispatch [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/dispatch-service.ts:75:24[90m)[39m
    at handleSpecificAgentDispatchRequest [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/index.ts:248:20[90m)[39m {
  code: [32m'ECONNREFUSED'[39m,
  errors: [
    Error: connect ECONNREFUSED 127.0.0.1:3000
    [90m    at createConnectionError (node:net:1678:14)[39m
    [90m    at afterConnectMultiple (node:net:1708:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'127.0.0.1'[39m,
      port: [33m3000[39m
    },
    Error: connect ECONNREFUSED ::1:3000
    [90m    at createConnectionError (node:net:1678:14)[39m
    [90m    at afterConnectMultiple (node:net:1708:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'::1'[39m,
      port: [33m3000[39m
    }
  ],
  config: {
    transitional: {
      silentJSONParsing: [33mtrue[39m,
      forcedJSONParsing: [33mtrue[39m,
      clarifyTimeoutError: [33mfalse[39m
    },
    adapter: [ [32m'xhr'[39m, [32m'http'[39m, [32m'fetch'[39m ],
    transformRequest: [ [36m[Function: transformRequest][39m ],
    transformResponse: [ [36m[Function: transformResponse][39m ],
    timeout: [33m90000[39m,
    xsrfCookieName: [32m'XSRF-TOKEN'[39m,
    xsrfHeaderName: [32m'X-XSRF-TOKEN'[39m,
    maxContentLength: [33m-1[39m,
    maxBodyLength: [33m-1[39m,
    env: { FormData: [36m[Function [FormData]][39m, Blob: [36m[class Blob][39m },
    validateStatus: [36m[Function: validateStatus][39m,
    headers: Object [AxiosHeaders] {
      Accept: [32m'application/json, text/plain, */*'[39m,
      [32m'Content-Type'[39m: [32m'application/json'[39m,
      [32m'User-Agent'[39m: [32m'axios/1.11.0'[39m,
      [32m'Content-Length'[39m: [32m'3644'[39m,
      [32m'Accept-Encoding'[39m: [32m'gzip, compress, deflate, br'[39m
    },
    method: [32m'post'[39m,
    data: [32m'{"agent":{"identifier":"gpt_4o","name":"GPT-4O Agent","description":"Advanced GPT-4O agent for complex tasks","prompt":"You are a helpful AI assistant powered by Cubicler.\\n\\nYou specialize in complex reasoning and analysis.\\n\\n## How You Operate as an AI Agent in Cubicler\\n\\nYou\'re an AI agent running in **Cubicler**, a smart orchestration system. Cubicler connects you to external services (weather, databases, etc.) via **function calls** — **never** through direct API requests.\\n\\n### ✅ Capabilities\\n\\n**1. Discover Services**\\n\\nCall `cubicler_available_servers()` - Lists available services (with IDs, names, descriptions)\\n\\n**2. Discover Tools in a Service**\\n\\nCall `cubicler_fetch_server_tools({ \\"serverIdentifier\\": \\"service_id\\" })` - Lists tools/functions for a specific service\\n\\n**3. Execute External Tools**\\n\\nCall `abc123_get_weather({ \\"city\\": \\"Jakarta\\" })` - Use exactly the names and parameter structures returned by discovery\\n\\n### 🧠 Workflow\\n\\n1. Understand the request (e.g., weather, user data)\\n2. Discover services if unsure: `cubicler_available_servers()`\\n3. Fetch tools from the relevant service: `cubicler_fetch_server_tools({ \\"serverIdentifier\\": \\"weather_service\\" })`\\n4. Call the tool with correct params: `abc123_get_current_weather({ \\"city\\": \\"Jakarta\\" })`\\n5. Return a clean, helpful response to the user\\n\\n### ⚠️ Rules\\n\\n**✅ DO:**\\n\\n- Only use listed tools\\n- Copy function names and parameters exactly\\n- Keep responses clear and non-technical\\n\\n**❌ DON\'T:**\\n\\n- Guess or make up tool names\\n- Modify function names or params\\n- Expose technical details to users\\n- Assume a service exists without checking\\n\\n### 💡 Example\\n\\nUser asks: **\\"What\'s the weather in Jakarta?\\"**\\n\\nYou:\\n\\n1. `cubicler_available_servers()`\\n2. `cubicler_fetch_server_tools({ \\"serverIdentifier\\": \\"weather_service\\" })`\\n3. `abc123_get_current_weather({ \\"city\\": \\"Jakarta\\" })`\\n4. Respond: _\\"The weather in Jakarta is 28°C and partly cloudy.\\"_\\n\\n**Goal:** Solve user problems by coordinating the right external tools via Cubicler with accuracy and clarity.\\n\\n## Currently Available Servers\\n\\nRight now, you have access to these external servers:\\n\\n**Weather Service** (`weather_service`)\\n- Provides weather information via MCP\\n- Available tools: 0\\n\\n**File Service** (`file_service`)\\n- File management via MCP\\n- Available tools: 0\\n\\n**User API** (`user_api`)\\n- Legacy REST API for user management\\n- Available tools: 2\\n\\nRemember: Use `cubicler_fetch_server_tools({\\"serverIdentifier\\": \\"service_identifier\\"})` to see exactly what functions each service provides."},"tools":[{"name":"cubicler_available_servers","description":"Get information about available servers managed by Cubicler","inputSchema":{"type":"object","properties":{}}},{"name":"cubicler_fetch_server_tools","description":"Get tools from one particular server managed by Cubicler","inputSchema":{"type":"object","properties":{"serverIdentifier":{"type":"string","description":"Identifier of the server to fetch tools from"}},"required":["serverIdentifier"]}},{"name":"sft7he_get_user","description":"Get user information by ID","inputSchema":{"type":"object","properties":{"userId":{"type":"string","description":"User ID to fetch"}},"required":["userId"]}},{"name":"sft7he_create_user","description":"Create a new user","inputSchema":{"type":"object","properties":{"payload":{"type":"object","properties":{"name":{"type":"string"},"email":{"type":"string"}},"required":["name","email"]}},"required":[]}}],"servers":[],"messages":[{"sender":{"id":"test_user"},"type":"text","content":"Hello"}]}'[39m,
    url: [32m'http://localhost:3000/agent'[39m,
    allowAbsoluteUrls: [33mtrue[39m
  },
  request: [36m<ref *1>[39m Writable {
    _events: {
      close: [90mundefined[39m,
      error: [36m[Function: handleRequestError][39m,
      prefinish: [90mundefined[39m,
      finish: [90mundefined[39m,
      drain: [90mundefined[39m,
      response: [36m[Function: handleResponse][39m,
      socket: [36m[Array][39m,
      timeout: [90mundefined[39m,
      abort: [90mundefined[39m
    },
    _writableState: WritableState {
      highWaterMark: [33m65536[39m,
      length: [33m0[39m,
      corked: [33m0[39m,
      onwrite: [36m[Function: bound onwrite][39m,
      writelen: [33m0[39m,
      bufferedIndex: [33m0[39m,
      pendingcb: [33m0[39m,
      [32mSymbol(kState)[39m: [33m17580812[39m,
      [32mSymbol(kBufferedValue)[39m: [1mnull[22m
    },
    _maxListeners: [90mundefined[39m,
    _options: {
      maxRedirects: [33m21[39m,
      maxBodyLength: [33mInfinity[39m,
      protocol: [32m'http:'[39m,
      path: [32m'/agent'[39m,
      method: [32m'POST'[39m,
      headers: [36m[Object: null prototype][39m,
      agents: [36m[Object][39m,
      auth: [90mundefined[39m,
      family: [90mundefined[39m,
      beforeRedirect: [36m[Function: dispatchBeforeRedirect][39m,
      beforeRedirects: [36m[Object][39m,
      hostname: [32m'localhost'[39m,
      port: [32m'3000'[39m,
      agent: [90mundefined[39m,
      nativeProtocols: [36m[Object][39m,
      pathname: [32m'/agent'[39m
    },
    _ended: [33mfalse[39m,
    _ending: [33mtrue[39m,
    _redirectCount: [33m0[39m,
    _redirects: [],
    _requestBodyLength: [33m3644[39m,
    _requestBodyBuffers: [ [36m[Object][39m ],
    _eventsCount: [33m3[39m,
    _onNativeResponse: [36m[Function (anonymous)][39m,
    _currentRequest: ClientRequest {
      _events: [36m[Object: null prototype][39m,
      _eventsCount: [33m7[39m,
      _maxListeners: [90mundefined[39m,
      outputData: [],
      outputSize: [33m0[39m,
      writable: [33mtrue[39m,
      destroyed: [33mfalse[39m,
      _last: [33mfalse[39m,
      chunkedEncoding: [33mfalse[39m,
      shouldKeepAlive: [33mtrue[39m,
      maxRequestsOnConnectionReached: [33mfalse[39m,
      _defaultKeepAlive: [33mtrue[39m,
      useChunkedEncodingByDefault: [33mtrue[39m,
      sendDate: [33mfalse[39m,
      _removedConnection: [33mfalse[39m,
      _removedContLen: [33mfalse[39m,
      _removedTE: [33mfalse[39m,
      strictContentLength: [33mfalse[39m,
      _contentLength: [33m3644[39m,
      _hasBody: [33mtrue[39m,
      _trailer: [32m''[39m,
      finished: [33mfalse[39m,
      _headerSent: [33mtrue[39m,
      _closed: [33mfalse[39m,
      _header: [32m'POST /agent HTTP/1.1\r\n'[39m +
        [32m'Accept: application/json, text/plain, */*\r\n'[39m +
        [32m'Content-Type: application/json\r\n'[39m +
        [32m'User-Agent: axios/1.11.0\r\n'[39m +
        [32m'Content-Length: 3644\r\n'[39m +
        [32m'Accept-Encoding: gzip, compress, deflate, br\r\n'[39m +
        [32m'Host: localhost:3000\r\n'[39m +
        [32m'Connection: keep-alive\r\n'[39m +
        [32m'\r\n'[39m,
      _keepAliveTimeout: [33m0[39m,
      _onPendingData: [36m[Function: nop][39m,
      agent: [36m[Agent][39m,
      socketPath: [90mundefined[39m,
      method: [32m'POST'[39m,
      maxHeaderSize: [90mundefined[39m,
      insecureHTTPParser: [90mundefined[39m,
      joinDuplicateHeaders: [90mundefined[39m,
      path: [32m'/agent'[39m,
      _ended: [33mfalse[39m,
      res: [1mnull[22m,
      aborted: [33mfalse[39m,
      timeoutCb: [36m[Function: emitRequestTimeout][39m,
      upgradeOrConnect: [33mfalse[39m,
      parser: [1mnull[22m,
      maxHeadersCount: [1mnull[22m,
      reusedSocket: [33mfalse[39m,
      host: [32m'localhost'[39m,
      protocol: [32m'http:'[39m,
      _redirectable: [36m[Circular *1][39m,
      [32mSymbol(shapeMode)[39m: [33mfalse[39m,
      [32mSymbol(kCapture)[39m: [33mfalse[39m,
      [32mSymbol(kBytesWritten)[39m: [33m0[39m,
      [32mSymbol(kNeedDrain)[39m: [33mfalse[39m,
      [32mSymbol(corked)[39m: [33m0[39m,
      [32mSymbol(kChunkedBuffer)[39m: [],
      [32mSymbol(kChunkedLength)[39m: [33m0[39m,
      [32mSymbol(kSocket)[39m: [36m[Socket][39m,
      [32mSymbol(kOutHeaders)[39m: [36m[Object: null prototype][39m,
      [32mSymbol(errored)[39m: [1mnull[22m,
      [32mSymbol(kHighWaterMark)[39m: [33m65536[39m,
      [32mSymbol(kRejectNonStandardBodyWrites)[39m: [33mfalse[39m,
      [32mSymbol(kUniqueHeaders)[39m: [1mnull[22m
    },
    _currentUrl: [32m'http://localhost:3000/agent'[39m,
    _timeout: [1mnull[22m,
    [32mSymbol(shapeMode)[39m: [33mtrue[39m,
    [32mSymbol(kCapture)[39m: [33mfalse[39m
  },
  cause: AggregateError: 
  [90m    at internalConnectMultiple (node:net:1134:18)[39m
  [90m    at afterConnectMultiple (node:net:1715:7)[39m {
    code: [32m'ECONNREFUSED'[39m,
    [errors]: [ [36m[Error][39m, [36m[Error][39m ]
  }
}

stderr | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch/:agentId > should accept agent ID parameter
❌ [DispatchService] Agent call failed: AxiosError [AggregateError]: 
    at AxiosError.from [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4maxios[24m/lib/core/AxiosError.js:92:14[90m)[39m
    at RedirectableRequest.handleRequestError [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4maxios[24m/lib/adapters/http.js:620:25[90m)[39m
[90m    at RedirectableRequest.emit (node:events:519:35)[39m
    at ClientRequest.eventHandlers.<computed> [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4mfollow-redirects[24m/index.js:49:24[90m)[39m
[90m    at ClientRequest.emit (node:events:507:28)[39m
[90m    at emitErrorEvent (node:_http_client:104:11)[39m
[90m    at Socket.socketErrorListener (node:_http_client:518:5)[39m
[90m    at Socket.emit (node:events:507:28)[39m
[90m    at emitErrorNT (node:internal/streams/destroy:170:8)[39m
[90m    at emitErrorCloseNT (node:internal/streams/destroy:129:3)[39m
    at Axios.request [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4maxios[24m/lib/core/Axios.js:45:41[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at axiosWithTimeout [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/utils/fetch-helper.ts:94:12[90m)[39m
    at HttpAgentTransport.dispatch [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/transport/agent/http-agent-transport.ts:34:24[90m)[39m
    at DispatchService.callAgent [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/dispatch-service.ts:108:12[90m)[39m
    at DispatchService.dispatch [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/dispatch-service.ts:75:24[90m)[39m
    at handleSpecificAgentDispatchRequest [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/index.ts:248:20[90m)[39m {
  code: [32m'ECONNREFUSED'[39m,
  errors: [
    Error: connect ECONNREFUSED 127.0.0.1:3000
    [90m    at createConnectionError (node:net:1678:14)[39m
    [90m    at afterConnectMultiple (node:net:1708:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'127.0.0.1'[39m,
      port: [33m3000[39m
    },
    Error: connect ECONNREFUSED ::1:3000
    [90m    at createConnectionError (node:net:1678:14)[39m
    [90m    at afterConnectMultiple (node:net:1708:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'::1'[39m,
      port: [33m3000[39m
    }
  ],
  config: {
    transitional: {
      silentJSONParsing: [33mtrue[39m,
      forcedJSONParsing: [33mtrue[39m,
      clarifyTimeoutError: [33mfalse[39m
    },
    adapter: [ [32m'xhr'[39m, [32m'http'[39m, [32m'fetch'[39m ],
    transformRequest: [ [36m[Function: transformRequest][39m ],
    transformResponse: [ [36m[Function: transformResponse][39m ],
    timeout: [33m90000[39m,
    xsrfCookieName: [32m'XSRF-TOKEN'[39m,
    xsrfHeaderName: [32m'X-XSRF-TOKEN'[39m,
    maxContentLength: [33m-1[39m,
    maxBodyLength: [33m-1[39m,
    env: { FormData: [36m[Function [FormData]][39m, Blob: [36m[class Blob][39m },
    validateStatus: [36m[Function: validateStatus][39m,
    headers: Object [AxiosHeaders] {
      Accept: [32m'application/json, text/plain, */*'[39m,
      [32m'Content-Type'[39m: [32m'application/json'[39m,
      [32m'User-Agent'[39m: [32m'axios/1.11.0'[39m,
      [32m'Content-Length'[39m: [32m'3644'[39m,
      [32m'Accept-Encoding'[39m: [32m'gzip, compress, deflate, br'[39m
    },
    method: [32m'post'[39m,
    data: [32m'{"agent":{"identifier":"gpt_4o","name":"GPT-4O Agent","description":"Advanced GPT-4O agent for complex tasks","prompt":"You are a helpful AI assistant powered by Cubicler.\\n\\nYou specialize in complex reasoning and analysis.\\n\\n## How You Operate as an AI Agent in Cubicler\\n\\nYou\'re an AI agent running in **Cubicler**, a smart orchestration system. Cubicler connects you to external services (weather, databases, etc.) via **function calls** — **never** through direct API requests.\\n\\n### ✅ Capabilities\\n\\n**1. Discover Services**\\n\\nCall `cubicler_available_servers()` - Lists available services (with IDs, names, descriptions)\\n\\n**2. Discover Tools in a Service**\\n\\nCall `cubicler_fetch_server_tools({ \\"serverIdentifier\\": \\"service_id\\" })` - Lists tools/functions for a specific service\\n\\n**3. Execute External Tools**\\n\\nCall `abc123_get_weather({ \\"city\\": \\"Jakarta\\" })` - Use exactly the names and parameter structures returned by discovery\\n\\n### 🧠 Workflow\\n\\n1. Understand the request (e.g., weather, user data)\\n2. Discover services if unsure: `cubicler_available_servers()`\\n3. Fetch tools from the relevant service: `cubicler_fetch_server_tools({ \\"serverIdentifier\\": \\"weather_service\\" })`\\n4. Call the tool with correct params: `abc123_get_current_weather({ \\"city\\": \\"Jakarta\\" })`\\n5. Return a clean, helpful response to the user\\n\\n### ⚠️ Rules\\n\\n**✅ DO:**\\n\\n- Only use listed tools\\n- Copy function names and parameters exactly\\n- Keep responses clear and non-technical\\n\\n**❌ DON\'T:**\\n\\n- Guess or make up tool names\\n- Modify function names or params\\n- Expose technical details to users\\n- Assume a service exists without checking\\n\\n### 💡 Example\\n\\nUser asks: **\\"What\'s the weather in Jakarta?\\"**\\n\\nYou:\\n\\n1. `cubicler_available_servers()`\\n2. `cubicler_fetch_server_tools({ \\"serverIdentifier\\": \\"weather_service\\" })`\\n3. `abc123_get_current_weather({ \\"city\\": \\"Jakarta\\" })`\\n4. Respond: _\\"The weather in Jakarta is 28°C and partly cloudy.\\"_\\n\\n**Goal:** Solve user problems by coordinating the right external tools via Cubicler with accuracy and clarity.\\n\\n## Currently Available Servers\\n\\nRight now, you have access to these external servers:\\n\\n**Weather Service** (`weather_service`)\\n- Provides weather information via MCP\\n- Available tools: 0\\n\\n**File Service** (`file_service`)\\n- File management via MCP\\n- Available tools: 0\\n\\n**User API** (`user_api`)\\n- Legacy REST API for user management\\n- Available tools: 2\\n\\nRemember: Use `cubicler_fetch_server_tools({\\"serverIdentifier\\": \\"service_identifier\\"})` to see exactly what functions each service provides."},"tools":[{"name":"cubicler_available_servers","description":"Get information about available servers managed by Cubicler","inputSchema":{"type":"object","properties":{}}},{"name":"cubicler_fetch_server_tools","description":"Get tools from one particular server managed by Cubicler","inputSchema":{"type":"object","properties":{"serverIdentifier":{"type":"string","description":"Identifier of the server to fetch tools from"}},"required":["serverIdentifier"]}},{"name":"sft7he_get_user","description":"Get user information by ID","inputSchema":{"type":"object","properties":{"userId":{"type":"string","description":"User ID to fetch"}},"required":["userId"]}},{"name":"sft7he_create_user","description":"Create a new user","inputSchema":{"type":"object","properties":{"payload":{"type":"object","properties":{"name":{"type":"string"},"email":{"type":"string"}},"required":["name","email"]}},"required":[]}}],"servers":[],"messages":[{"sender":{"id":"test_user"},"type":"text","content":"Hello"}]}'[39m,
    url: [32m'http://localhost:3000/agent'[39m,
    allowAbsoluteUrls: [33mtrue[39m
  },
  request: [36m<ref *1>[39m Writable {
    _events: {
      close: [90mundefined[39m,
      error: [36m[Function: handleRequestError][39m,
      prefinish: [90mundefined[39m,
      finish: [90mundefined[39m,
      drain: [90mundefined[39m,
      response: [36m[Function: handleResponse][39m,
      socket: [36m[Array][39m,
      timeout: [90mundefined[39m,
      abort: [90mundefined[39m
    },
    _writableState: WritableState {
      highWaterMark: [33m65536[39m,
      length: [33m0[39m,
      corked: [33m0[39m,
      onwrite: [36m[Function: bound onwrite][39m,
      writelen: [33m0[39m,
      bufferedIndex: [33m0[39m,
      pendingcb: [33m0[39m,
      [32mSymbol(kState)[39m: [33m17580812[39m,
      [32mSymbol(kBufferedValue)[39m: [1mnull[22m
    },
    _maxListeners: [90mundefined[39m,
    _options: {
      maxRedirects: [33m21[39m,
      maxBodyLength: [33mInfinity[39m,
      protocol: [32m'http:'[39m,
      path: [32m'/agent'[39m,
      method: [32m'POST'[39m,
      headers: [36m[Object: null prototype][39m,
      agents: [36m[Object][39m,
      auth: [90mundefined[39m,
      family: [90mundefined[39m,
      beforeRedirect: [36m[Function: dispatchBeforeRedirect][39m,
      beforeRedirects: [36m[Object][39m,
      hostname: [32m'localhost'[39m,
      port: [32m'3000'[39m,
      agent: [90mundefined[39m,
      nativeProtocols: [36m[Object][39m,
      pathname: [32m'/agent'[39m
    },
    _ended: [33mfalse[39m,
    _ending: [33mtrue[39m,
    _redirectCount: [33m0[39m,
    _redirects: [],
    _requestBodyLength: [33m3644[39m,
    _requestBodyBuffers: [ [36m[Object][39m ],
    _eventsCount: [33m3[39m,
    _onNativeResponse: [36m[Function (anonymous)][39m,
    _currentRequest: ClientRequest {
      _events: [36m[Object: null prototype][39m,
      _eventsCount: [33m7[39m,
      _maxListeners: [90mundefined[39m,
      outputData: [],
      outputSize: [33m0[39m,
      writable: [33mtrue[39m,
      destroyed: [33mfalse[39m,
      _last: [33mfalse[39m,
      chunkedEncoding: [33mfalse[39m,
      shouldKeepAlive: [33mtrue[39m,
      maxRequestsOnConnectionReached: [33mfalse[39m,
      _defaultKeepAlive: [33mtrue[39m,
      useChunkedEncodingByDefault: [33mtrue[39m,
      sendDate: [33mfalse[39m,
      _removedConnection: [33mfalse[39m,
      _removedContLen: [33mfalse[39m,
      _removedTE: [33mfalse[39m,
      strictContentLength: [33mfalse[39m,
      _contentLength: [33m3644[39m,
      _hasBody: [33mtrue[39m,
      _trailer: [32m''[39m,
      finished: [33mfalse[39m,
      _headerSent: [33mtrue[39m,
      _closed: [33mfalse[39m,
      _header: [32m'POST /agent HTTP/1.1\r\n'[39m +
        [32m'Accept: application/json, text/plain, */*\r\n'[39m +
        [32m'Content-Type: application/json\r\n'[39m +
        [32m'User-Agent: axios/1.11.0\r\n'[39m +
        [32m'Content-Length: 3644\r\n'[39m +
        [32m'Accept-Encoding: gzip, compress, deflate, br\r\n'[39m +
        [32m'Host: localhost:3000\r\n'[39m +
        [32m'Connection: keep-alive\r\n'[39m +
        [32m'\r\n'[39m,
      _keepAliveTimeout: [33m0[39m,
      _onPendingData: [36m[Function: nop][39m,
      agent: [36m[Agent][39m,
      socketPath: [90mundefined[39m,
      method: [32m'POST'[39m,
      maxHeaderSize: [90mundefined[39m,
      insecureHTTPParser: [90mundefined[39m,
      joinDuplicateHeaders: [90mundefined[39m,
      path: [32m'/agent'[39m,
      _ended: [33mfalse[39m,
      res: [1mnull[22m,
      aborted: [33mfalse[39m,
      timeoutCb: [36m[Function: emitRequestTimeout][39m,
      upgradeOrConnect: [33mfalse[39m,
      parser: [1mnull[22m,
      maxHeadersCount: [1mnull[22m,
      reusedSocket: [33mfalse[39m,
      host: [32m'localhost'[39m,
      protocol: [32m'http:'[39m,
      _redirectable: [36m[Circular *1][39m,
      [32mSymbol(shapeMode)[39m: [33mfalse[39m,
      [32mSymbol(kCapture)[39m: [33mfalse[39m,
      [32mSymbol(kBytesWritten)[39m: [33m0[39m,
      [32mSymbol(kNeedDrain)[39m: [33mfalse[39m,
      [32mSymbol(corked)[39m: [33m0[39m,
      [32mSymbol(kChunkedBuffer)[39m: [],
      [32mSymbol(kChunkedLength)[39m: [33m0[39m,
      [32mSymbol(kSocket)[39m: [36m[Socket][39m,
      [32mSymbol(kOutHeaders)[39m: [36m[Object: null prototype][39m,
      [32mSymbol(errored)[39m: [1mnull[22m,
      [32mSymbol(kHighWaterMark)[39m: [33m65536[39m,
      [32mSymbol(kRejectNonStandardBodyWrites)[39m: [33mfalse[39m,
      [32mSymbol(kUniqueHeaders)[39m: [1mnull[22m
    },
    _currentUrl: [32m'http://localhost:3000/agent'[39m,
    _timeout: [1mnull[22m,
    [32mSymbol(shapeMode)[39m: [33mtrue[39m,
    [32mSymbol(kCapture)[39m: [33mfalse[39m
  },
  cause: AggregateError: 
  [90m    at internalConnectMultiple (node:net:1134:18)[39m
  [90m    at afterConnectMultiple (node:net:1715:7)[39m {
    code: [32m'ECONNREFUSED'[39m,
    [errors]: [ [36m[Error][39m, [36m[Error][39m ]
  }
}

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /dispatch/:agentId > should accept agent ID parameter
✅ [Server] POST /dispatch/gpt_4o - Success

stdout | tests/core/dispatch-service.test.ts > Dispatch Service > dispatch > should dispatch message to specific agent
🔧 [DispatchService] Created with MCP service and agent provider

stdout | tests/core/dispatch-service.test.ts > Dispatch Service > dispatch > should dispatch message to specific agent
📨 [DispatchService] Dispatching to agent: claude_3_5

stdout | tests/core/dispatch-service.test.ts > Dispatch Service > dispatch > should dispatch message to specific agent
🚀 [DispatchService] Calling agent Claude 3.5 Agent via http

stdout | tests/core/dispatch-service.test.ts > Dispatch Service > dispatch > should dispatch message to specific agent
✅ [DispatchService] Agent Claude 3.5 Agent responded successfully

stdout | tests/core/dispatch-service.test.ts > Dispatch Service > dispatch > should handle agent transport errors
🔧 [DispatchService] Created with MCP service and agent provider

stdout | tests/core/dispatch-service.test.ts > Dispatch Service > dispatch > should handle agent transport errors
📨 [DispatchService] Dispatching to agent: default

stdout | tests/core/dispatch-service.test.ts > Dispatch Service > dispatch > should handle agent transport errors
🚀 [DispatchService] Calling agent Test Agent via http

stdout | tests/core/internal-tools-service.test.ts
[dotenv@17.2.0] injecting env (0) from .env (tip: ⚙️  write to custom object with { processEnv: myObject })

stdout | tests/core/agent-service.test.ts
[dotenv@17.2.0] injecting env (10) from .env (tip: 🔐 prevent building .env in docker: https://dotenvx.com/prebuild)

stdout | tests/provider-rest-service-query-fix.test.ts
[dotenv@17.2.0] injecting env (10) from .env (tip: 🛠️  run anywhere with `dotenvx run -- yourcommand`)

stderr | tests/core/dispatch-service.test.ts > Dispatch Service > dispatch > should handle agent transport errors
❌ [DispatchService] Agent call failed: Error: Network error
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/core/dispatch-service.test.ts:264:28
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m

stdout | tests/core/dispatch-service.test.ts > Dispatch Service > dispatch > should handle invalid response format from agent
🔧 [DispatchService] Created with MCP service and agent provider

stdout | tests/core/dispatch-service.test.ts > Dispatch Service > dispatch > should handle invalid response format from agent
📨 [DispatchService] Dispatching to agent: default

stdout | tests/core/dispatch-service.test.ts > Dispatch Service > dispatch > should handle invalid response format from agent
🚀 [DispatchService] Calling agent Test Agent via http

stderr | tests/core/dispatch-service.test.ts > Dispatch Service > dispatch > should handle invalid response format from agent
❌ [DispatchService] Agent call failed: Error: Invalid agent response format: missing required fields (timestamp, type, content, metadata)
    at DispatchService.validateAgentResponseFormat [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/dispatch-service.ts:219:13[90m)[39m
    at DispatchService.handleAgentResponse [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/dispatch-service.ts:194:10[90m)[39m
    at DispatchService.dispatch [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/dispatch-service.ts:76:25[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/core/dispatch-service.test.ts:316:22
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20

stdout | tests/core/dispatch-service.test.ts > Dispatch Service > dispatch > should validate messages array
🔧 [DispatchService] Created with MCP service and agent provider

stdout | tests/core/dispatch-service.test.ts > Dispatch Service > dispatch > should validate messages array
📨 [DispatchService] Dispatching to agent: default

 ✓ tests/core/dispatch-service.test.ts (5 tests) 363ms
stdout | tests/provider-rest-service-query-fix.test.ts > ProviderRESTService Query Field Fix > canHandleRequest with query field support > should correctly identify tools that can be handled
🔍 [ProviderRESTService] Checking if can handle: 1r2dj4_get_current_weather

stdout | tests/provider-rest-service-query-fix.test.ts > ProviderRESTService Query Field Fix > canHandleRequest with query field support > should correctly identify tools that can be handled
🔍 [ProviderRESTService] Can handle 1r2dj4_get_current_weather: false

stdout | tests/provider-rest-service-query-fix.test.ts > ProviderRESTService Query Field Fix > canHandleRequest with query field support > should correctly identify tools that can be handled
🔍 [ProviderRESTService] Checking if can handle: s9x8y7z_get_post_by_id

stdout | tests/provider-rest-service-query-fix.test.ts > ProviderRESTService Query Field Fix > canHandleRequest with query field support > should correctly identify tools that can be handled
🔍 [ProviderRESTService] Can handle s9x8y7z_get_post_by_id: false

stdout | tests/core/agent-service.test.ts
[dotenv@17.2.0] injecting env (0) from .env (tip: 🛠️  run anywhere with `dotenvx run -- yourcommand`)

stdout | tests/core/internal-tools-service.test.ts > Internal Tools Service > toolsCall > should throw error for unknown internal tool
⚙️ [InternalToolsService] Executing internal tool: cubicler_unknownTool

 ✓ tests/provider-rest-service-query-fix.test.ts (2 tests) 179ms
stdout | tests/core/internal-tools-service.test.ts > Internal Tools Service > toolsCall > should throw error for missing serverIdentifier in fetch_server_tools
⚙️ [InternalToolsService] Executing internal tool: cubicler_fetch_server_tools

stdout | tests/core/internal-tools-service.test.ts > Internal Tools Service > toolsCall > should execute cubicler_available_servers successfully
⚙️ [InternalToolsService] Executing internal tool: cubicler_available_servers

stdout | tests/core/internal-tools-service.test.ts > Internal Tools Service > toolsCall > should execute cubicler_available_servers successfully
✅ [InternalToolsService] Found 2 servers

stdout | tests/core/agent-service.test.ts
[dotenv@17.2.0] injecting env (0) from .env (tip: 🔐 encrypt with dotenvx: https://dotenvx.com)

stdout | tests/core/agent-service.test.ts
[dotenv@17.2.0] injecting env (0) from .env (tip: 🔐 prevent building .env in docker: https://dotenvx.com/prebuild)

stdout | tests/core/internal-tools-service.test.ts > Internal Tools Service > toolsCall > should execute cubicler_fetch_server_tools for cubicler server
⚙️ [InternalToolsService] Executing internal tool: cubicler_fetch_server_tools

stdout | tests/core/internal-tools-service.test.ts > Internal Tools Service > toolsCall > should return tools for a specific server
⚙️ [InternalToolsService] Executing internal tool: cubicler_fetch_server_tools

stdout | tests/core/internal-tools-service.test.ts > Internal Tools Service > toolsCall > should return tools for a specific server
✅ [InternalToolsService] Found 1 tools for server: weather_service

stdout | tests/core/internal-tools-service.test.ts > Internal Tools Service > toolsCall > should throw error for non-existent server in fetch_server_tools
⚙️ [InternalToolsService] Executing internal tool: cubicler_fetch_server_tools

stderr | tests/core/internal-tools-service.test.ts > Internal Tools Service > toolsCall > should throw error for non-existent server in fetch_server_tools
❌ [InternalToolsService] Error getting tools for server non_existent_service: Error: Server not found: non_existent_service
    at InternalToolsService.getServerHash [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/internal-tools-service.ts:191:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at InternalToolsService.fetchServerTools [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/internal-tools-service.ts:153:26[90m)[39m
    at InternalToolsService.toolsCall [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/internal-tools-service.ts:93:16[90m)[39m

stdout | tests/core/internal-tools-service.test.ts > Internal Tools Service > toolsCall > should handle provider errors gracefully in available_servers
⚙️ [InternalToolsService] Executing internal tool: cubicler_available_servers

stdout | tests/core/internal-tools-service.test.ts > Internal Tools Service > toolsCall > should handle provider errors gracefully in available_servers
✅ [InternalToolsService] Found 1 servers

stdout | tests/core/internal-tools-service.test.ts > Internal Tools Service > toolsCall > should handle provider errors gracefully in fetch_server_tools
⚙️ [InternalToolsService] Executing internal tool: cubicler_fetch_server_tools

stderr | tests/core/internal-tools-service.test.ts > Internal Tools Service > toolsCall > should handle provider errors gracefully in fetch_server_tools
⚠️ [InternalToolsService] Failed to get tools from service weather_service: Error: Provider error
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/core/internal-tools-service.test.ts:224:68
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m

stdout | tests/core/internal-tools-service.test.ts > Internal Tools Service > toolsCall > should handle provider errors gracefully in fetch_server_tools
✅ [InternalToolsService] Found 1 tools for server: search_service

stdout | tests/core/internal-tools-service.test.ts > Internal Tools Service > initialize > should initialize successfully
🔄 [InternalToolsService] Initializing internal tools service...
✅ [InternalToolsService] Internal tools service initialized

stdout | tests/core/agent-service.test.ts > Agent Service > getAgentPrompt > should compose prompt with base + agent-specific prompt
📝 [PromptHelper] Using inline base prompt (31 characters)

stdout | tests/core/agent-service.test.ts > Agent Service > getAgentPrompt > should compose prompt with base + agent-specific prompt
📝 [PromptHelper] Using inline agent prompt for agent_with_prompt (32 characters)

stdout | tests/core/agent-service.test.ts > Agent Service > getAgentPrompt > should compose prompt with base + default prompt when agent has no specific prompt
📝 [PromptHelper] Using inline base prompt (31 characters)

stdout | tests/core/agent-service.test.ts > Agent Service > getAgentPrompt > should compose prompt with base + default prompt when agent has no specific prompt
📝 [PromptHelper] Using inline default prompt (25 characters)

stdout | tests/core/agent-service.test.ts > Agent Service > getAgentPrompt > should use default agent when no agent identifier provided
📝 [PromptHelper] Using inline base prompt (31 characters)

stdout | tests/core/agent-service.test.ts > Agent Service > getAgentPrompt > should use default agent when no agent identifier provided
📝 [PromptHelper] Using inline agent prompt for first_agent (32 characters)

 ✓ tests/core/internal-tools-service.test.ts (14 tests) 271ms
stdout | tests/core/agent-service.test.ts > Agent Service > getAgentPrompt > should handle missing base prompt
📝 [PromptHelper] Using inline agent prompt for test_agent (20 characters)

stdout | tests/core/agent-service.test.ts > Agent Service > getAgentPrompt > should handle case when servers provider fails
📝 [PromptHelper] Using inline base prompt (31 characters)

stderr | tests/core/agent-service.test.ts > Agent Service > getAgentPrompt > should handle case when servers provider fails
⚠️ [AgentService] Failed to fetch server information: Error: Server error
    at [90m/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mtests/core/agent-service.test.ts:300:9
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m

 ✓ tests/core/agent-service.test.ts (12 tests) 263ms
stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /mcp > should handle MCP protocol requests
[dotenv@17.2.0] injecting env (7) from .env (tip: 🔐 prevent committing .env to code: https://dotenvx.com/precommit)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /mcp > should handle MCP protocol requests
[dotenv@17.2.0] injecting env (0) from .env (tip: ⚙️  write to custom object with { processEnv: myObject })

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /mcp > should handle MCP protocol requests
[dotenv@17.2.0] injecting env (0) from .env (tip: 🔐 prevent committing .env to code: https://dotenvx.com/precommit)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /mcp > should handle MCP protocol requests
[dotenv@17.2.0] injecting env (0) from .env (tip: 🔐 encrypt with dotenvx: https://dotenvx.com)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /mcp > should handle MCP protocol requests
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /mcp > should handle MCP protocol requests
🔧 [DispatchService] Created with MCP service and agent provider

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /mcp > should handle MCP protocol requests
📡 [Server] POST /mcp - MCP request: tools/list
📡 [MCPService] Handling MCP request: tools/list
🔧 [MCPService] Handling tools/list request

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /mcp > should handle MCP protocol requests
📋 [ConfigHelper] Loading providers configuration from: ./tests/mocks/test-providers.json
📁 [ConfigHelper] Loading from local file...
✅ [ConfigHelper] Successfully loaded providers configuration from local file
🔄 [ConfigHelper] Applied environment variable substitution to providers configuration

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /mcp > should handle MCP protocol requests
✅ [ProvidersRepository] Loaded 2 MCP servers and 1 REST servers

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /mcp > should handle MCP protocol requests
🔧 [ProviderMCPService] Loading MCP tools from weather_service...
✅ [HttpMCPTransport] Initialized HTTP transport for weather_service

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /mcp > should handle MCP protocol requests
📡 [HttpMCPTransport] Sending HTTP request to weather_service: tools/list

stderr | tests/integration/api-endpoints.test.ts > Integration Tests > POST /mcp > should handle MCP protocol requests
❌ [HttpMCPTransport] HTTP request to weather_service failed: AxiosError [AggregateError]: 
    at AxiosError.from [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4maxios[24m/lib/core/AxiosError.js:92:14[90m)[39m
    at RedirectableRequest.handleRequestError [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4maxios[24m/lib/adapters/http.js:620:25[90m)[39m
[90m    at RedirectableRequest.emit (node:events:519:35)[39m
    at ClientRequest.eventHandlers.<computed> [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4mfollow-redirects[24m/index.js:49:24[90m)[39m
[90m    at ClientRequest.emit (node:events:507:28)[39m
[90m    at emitErrorEvent (node:_http_client:104:11)[39m
[90m    at Socket.socketErrorListener (node:_http_client:518:5)[39m
[90m    at Socket.emit (node:events:507:28)[39m
[90m    at emitErrorNT (node:internal/streams/destroy:170:8)[39m
[90m    at emitErrorCloseNT (node:internal/streams/destroy:129:3)[39m
    at Axios.request [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4maxios[24m/lib/core/Axios.js:45:41[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at axiosWithTimeout [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/utils/fetch-helper.ts:94:12[90m)[39m
    at HttpMCPTransport.sendRequest [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/transport/mcp/http-mcp-transport.ts:45:24[90m)[39m
    at ProviderMCPService.getMCPTools [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:263:22[90m)[39m
    at ProviderMCPService.loadToolsFromServer [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:218:22[90m)[39m
    at ProviderMCPService.toolsList [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:85:23[90m)[39m
    at MCPService.aggregateToolsFromProviders [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/mcp-service.ts:172:29[90m)[39m
    at MCPService.handleToolsList [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/mcp-service.ts:142:24[90m)[39m
    at MCPService.routeRequest [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/mcp-service.ts:74:16[90m)[39m {
  code: [32m'ECONNREFUSED'[39m,
  errors: [
    Error: connect ECONNREFUSED 127.0.0.1:4000
    [90m    at createConnectionError (node:net:1678:14)[39m
    [90m    at afterConnectMultiple (node:net:1708:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'127.0.0.1'[39m,
      port: [33m4000[39m
    },
    Error: connect ECONNREFUSED ::1:4000
    [90m    at createConnectionError (node:net:1678:14)[39m
    [90m    at afterConnectMultiple (node:net:1708:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'::1'[39m,
      port: [33m4000[39m
    }
  ],
  config: {
    transitional: {
      silentJSONParsing: [33mtrue[39m,
      forcedJSONParsing: [33mtrue[39m,
      clarifyTimeoutError: [33mfalse[39m
    },
    adapter: [ [32m'xhr'[39m, [32m'http'[39m, [32m'fetch'[39m ],
    transformRequest: [ [36m[Function: transformRequest][39m ],
    transformResponse: [ [36m[Function: transformResponse][39m ],
    timeout: [33m30000[39m,
    xsrfCookieName: [32m'XSRF-TOKEN'[39m,
    xsrfHeaderName: [32m'X-XSRF-TOKEN'[39m,
    maxContentLength: [33m-1[39m,
    maxBodyLength: [33m-1[39m,
    env: { FormData: [36m[Function [FormData]][39m, Blob: [36m[class Blob][39m },
    validateStatus: [36m[Function: validateStatus][39m,
    headers: Object [AxiosHeaders] {
      Accept: [32m'application/json, text/plain, */*'[39m,
      [32m'Content-Type'[39m: [32m'application/json'[39m,
      Authorization: [32m'Bearer test-token'[39m,
      [32m'User-Agent'[39m: [32m'axios/1.11.0'[39m,
      [32m'Content-Length'[39m: [32m'72'[39m,
      [32m'Accept-Encoding'[39m: [32m'gzip, compress, deflate, br'[39m
    },
    method: [32m'post'[39m,
    data: [32m'{"jsonrpc":"2.0","id":"tools-request","method":"tools/list","params":{}}'[39m,
    url: [32m'http://localhost:4000/mcp'[39m,
    allowAbsoluteUrls: [33mtrue[39m
  },
  request: [36m<ref *1>[39m Writable {
    _events: {
      close: [90mundefined[39m,
      error: [36m[Function: handleRequestError][39m,
      prefinish: [90mundefined[39m,
      finish: [90mundefined[39m,
      drain: [90mundefined[39m,
      response: [36m[Function: handleResponse][39m,
      socket: [36m[Array][39m,
      timeout: [90mundefined[39m,
      abort: [90mundefined[39m
    },
    _writableState: WritableState {
      highWaterMark: [33m65536[39m,
      length: [33m0[39m,
      corked: [33m0[39m,
      onwrite: [36m[Function: bound onwrite][39m,
      writelen: [33m0[39m,
      bufferedIndex: [33m0[39m,
      pendingcb: [33m0[39m,
      [32mSymbol(kState)[39m: [33m17580812[39m,
      [32mSymbol(kBufferedValue)[39m: [1mnull[22m
    },
    _maxListeners: [90mundefined[39m,
    _options: {
      maxRedirects: [33m21[39m,
      maxBodyLength: [33mInfinity[39m,
      protocol: [32m'http:'[39m,
      path: [32m'/mcp'[39m,
      method: [32m'POST'[39m,
      headers: [36m[Object: null prototype][39m,
      agents: [36m[Object][39m,
      auth: [90mundefined[39m,
      family: [90mundefined[39m,
      beforeRedirect: [36m[Function: dispatchBeforeRedirect][39m,
      beforeRedirects: [36m[Object][39m,
      hostname: [32m'localhost'[39m,
      port: [32m'4000'[39m,
      agent: [90mundefined[39m,
      nativeProtocols: [36m[Object][39m,
      pathname: [32m'/mcp'[39m
    },
    _ended: [33mfalse[39m,
    _ending: [33mtrue[39m,
    _redirectCount: [33m0[39m,
    _redirects: [],
    _requestBodyLength: [33m72[39m,
    _requestBodyBuffers: [ [36m[Object][39m ],
    _eventsCount: [33m3[39m,
    _onNativeResponse: [36m[Function (anonymous)][39m,
    _currentRequest: ClientRequest {
      _events: [36m[Object: null prototype][39m,
      _eventsCount: [33m7[39m,
      _maxListeners: [90mundefined[39m,
      outputData: [],
      outputSize: [33m0[39m,
      writable: [33mtrue[39m,
      destroyed: [33mfalse[39m,
      _last: [33mfalse[39m,
      chunkedEncoding: [33mfalse[39m,
      shouldKeepAlive: [33mtrue[39m,
      maxRequestsOnConnectionReached: [33mfalse[39m,
      _defaultKeepAlive: [33mtrue[39m,
      useChunkedEncodingByDefault: [33mtrue[39m,
      sendDate: [33mfalse[39m,
      _removedConnection: [33mfalse[39m,
      _removedContLen: [33mfalse[39m,
      _removedTE: [33mfalse[39m,
      strictContentLength: [33mfalse[39m,
      _contentLength: [33m72[39m,
      _hasBody: [33mtrue[39m,
      _trailer: [32m''[39m,
      finished: [33mfalse[39m,
      _headerSent: [33mtrue[39m,
      _closed: [33mfalse[39m,
      _header: [32m'POST /mcp HTTP/1.1\r\n'[39m +
        [32m'Accept: application/json, text/plain, */*\r\n'[39m +
        [32m'Content-Type: application/json\r\n'[39m +
        [32m'Authorization: Bearer test-token\r\n'[39m +
        [32m'User-Agent: axios/1.11.0\r\n'[39m +
        [32m'Content-Length: 72\r\n'[39m +
        [32m'Accept-Encoding: gzip, compress, deflate, br\r\n'[39m +
        [32m'Host: localhost:4000\r\n'[39m +
        [32m'Connection: keep-alive\r\n'[39m +
        [32m'\r\n'[39m,
      _keepAliveTimeout: [33m0[39m,
      _onPendingData: [36m[Function: nop][39m,
      agent: [36m[Agent][39m,
      socketPath: [90mundefined[39m,
      method: [32m'POST'[39m,
      maxHeaderSize: [90mundefined[39m,
      insecureHTTPParser: [90mundefined[39m,
      joinDuplicateHeaders: [90mundefined[39m,
      path: [32m'/mcp'[39m,
      _ended: [33mfalse[39m,
      res: [1mnull[22m,
      aborted: [33mfalse[39m,
      timeoutCb: [36m[Function: emitRequestTimeout][39m,
      upgradeOrConnect: [33mfalse[39m,
      parser: [1mnull[22m,
      maxHeadersCount: [1mnull[22m,
      reusedSocket: [33mfalse[39m,
      host: [32m'localhost'[39m,
      protocol: [32m'http:'[39m,
      _redirectable: [36m[Circular *1][39m,
      [32mSymbol(shapeMode)[39m: [33mfalse[39m,
      [32mSymbol(kCapture)[39m: [33mfalse[39m,
      [32mSymbol(kBytesWritten)[39m: [33m0[39m,
      [32mSymbol(kNeedDrain)[39m: [33mfalse[39m,
      [32mSymbol(corked)[39m: [33m0[39m,
      [32mSymbol(kChunkedBuffer)[39m: [],
      [32mSymbol(kChunkedLength)[39m: [33m0[39m,
      [32mSymbol(kSocket)[39m: [36m[Socket][39m,
      [32mSymbol(kOutHeaders)[39m: [36m[Object: null prototype][39m,
      [32mSymbol(errored)[39m: [1mnull[22m,
      [32mSymbol(kHighWaterMark)[39m: [33m65536[39m,
      [32mSymbol(kRejectNonStandardBodyWrites)[39m: [33mfalse[39m,
      [32mSymbol(kUniqueHeaders)[39m: [1mnull[22m
    },
    _currentUrl: [32m'http://localhost:4000/mcp'[39m,
    _timeout: [1mnull[22m,
    [32mSymbol(shapeMode)[39m: [33mtrue[39m,
    [32mSymbol(kCapture)[39m: [33mfalse[39m
  },
  cause: AggregateError: 
  [90m    at internalConnectMultiple (node:net:1134:18)[39m
  [90m    at afterConnectMultiple (node:net:1715:7)[39m {
    code: [32m'ECONNREFUSED'[39m,
    [errors]: [ [36m[Error][39m, [36m[Error][39m ]
  }
}

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /mcp > should handle MCP protocol requests
🔧 [ProviderMCPService] Loading MCP tools from file_service...
✅ [HttpMCPTransport] Initialized HTTP transport for file_service

stderr | tests/integration/api-endpoints.test.ts > Integration Tests > POST /mcp > should handle MCP protocol requests
⚠️ [ProviderMCPService] Failed to get MCP tools from weather_service: Error: MCP tools request failed: HTTP request failed: 
    at ProviderMCPService.getMCPTools [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:266:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at ProviderMCPService.loadToolsFromServer [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:218:22[90m)[39m
    at ProviderMCPService.toolsList [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:85:23[90m)[39m
    at MCPService.aggregateToolsFromProviders [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/mcp-service.ts:172:29[90m)[39m
    at MCPService.handleToolsList [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/mcp-service.ts:142:24[90m)[39m
    at MCPService.routeRequest [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/mcp-service.ts:74:16[90m)[39m
    at MCPService.handleMCPRequest [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/mcp-service.ts:51:14[90m)[39m
    at handleMCPRequest [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/index.ts:388:20[90m)[39m

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /mcp > should handle MCP protocol requests
📡 [HttpMCPTransport] Sending HTTP request to file_service: tools/list

stderr | tests/integration/api-endpoints.test.ts > Integration Tests > POST /mcp > should handle MCP protocol requests
❌ [HttpMCPTransport] HTTP request to file_service failed: AxiosError [AggregateError]: 
    at AxiosError.from [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4maxios[24m/lib/core/AxiosError.js:92:14[90m)[39m
    at RedirectableRequest.handleRequestError [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4maxios[24m/lib/adapters/http.js:620:25[90m)[39m
[90m    at RedirectableRequest.emit (node:events:519:35)[39m
    at ClientRequest.eventHandlers.<computed> [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4mfollow-redirects[24m/index.js:49:24[90m)[39m
[90m    at ClientRequest.emit (node:events:507:28)[39m
[90m    at emitErrorEvent (node:_http_client:104:11)[39m
[90m    at Socket.socketErrorListener (node:_http_client:518:5)[39m
[90m    at Socket.emit (node:events:507:28)[39m
[90m    at emitErrorNT (node:internal/streams/destroy:170:8)[39m
[90m    at emitErrorCloseNT (node:internal/streams/destroy:129:3)[39m
    at Axios.request [90m(file:///Users/nayandahaberty/Code/Cubicler/Cubicler/[39mnode_modules/[4maxios[24m/lib/core/Axios.js:45:41[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at axiosWithTimeout [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/utils/fetch-helper.ts:94:12[90m)[39m
    at HttpMCPTransport.sendRequest [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/transport/mcp/http-mcp-transport.ts:45:24[90m)[39m
    at ProviderMCPService.getMCPTools [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:263:22[90m)[39m
    at ProviderMCPService.loadToolsFromServer [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:218:22[90m)[39m
    at ProviderMCPService.toolsList [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:85:23[90m)[39m
    at MCPService.aggregateToolsFromProviders [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/mcp-service.ts:172:29[90m)[39m
    at MCPService.handleToolsList [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/mcp-service.ts:142:24[90m)[39m
    at MCPService.routeRequest [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/mcp-service.ts:74:16[90m)[39m {
  code: [32m'ECONNREFUSED'[39m,
  errors: [
    Error: connect ECONNREFUSED 127.0.0.1:4001
    [90m    at createConnectionError (node:net:1678:14)[39m
    [90m    at afterConnectMultiple (node:net:1708:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'127.0.0.1'[39m,
      port: [33m4001[39m
    },
    Error: connect ECONNREFUSED ::1:4001
    [90m    at createConnectionError (node:net:1678:14)[39m
    [90m    at afterConnectMultiple (node:net:1708:16)[39m {
      errno: [33m-61[39m,
      code: [32m'ECONNREFUSED'[39m,
      syscall: [32m'connect'[39m,
      address: [32m'::1'[39m,
      port: [33m4001[39m
    }
  ],
  config: {
    transitional: {
      silentJSONParsing: [33mtrue[39m,
      forcedJSONParsing: [33mtrue[39m,
      clarifyTimeoutError: [33mfalse[39m
    },
    adapter: [ [32m'xhr'[39m, [32m'http'[39m, [32m'fetch'[39m ],
    transformRequest: [ [36m[Function: transformRequest][39m ],
    transformResponse: [ [36m[Function: transformResponse][39m ],
    timeout: [33m30000[39m,
    xsrfCookieName: [32m'XSRF-TOKEN'[39m,
    xsrfHeaderName: [32m'X-XSRF-TOKEN'[39m,
    maxContentLength: [33m-1[39m,
    maxBodyLength: [33m-1[39m,
    env: { FormData: [36m[Function [FormData]][39m, Blob: [36m[class Blob][39m },
    validateStatus: [36m[Function: validateStatus][39m,
    headers: Object [AxiosHeaders] {
      Accept: [32m'application/json, text/plain, */*'[39m,
      [32m'Content-Type'[39m: [32m'application/json'[39m,
      [32m'User-Agent'[39m: [32m'axios/1.11.0'[39m,
      [32m'Content-Length'[39m: [32m'72'[39m,
      [32m'Accept-Encoding'[39m: [32m'gzip, compress, deflate, br'[39m
    },
    method: [32m'post'[39m,
    data: [32m'{"jsonrpc":"2.0","id":"tools-request","method":"tools/list","params":{}}'[39m,
    url: [32m'http://localhost:4001/mcp'[39m,
    allowAbsoluteUrls: [33mtrue[39m
  },
  request: [36m<ref *1>[39m Writable {
    _events: {
      close: [90mundefined[39m,
      error: [36m[Function: handleRequestError][39m,
      prefinish: [90mundefined[39m,
      finish: [90mundefined[39m,
      drain: [90mundefined[39m,
      response: [36m[Function: handleResponse][39m,
      socket: [36m[Array][39m,
      timeout: [90mundefined[39m,
      abort: [90mundefined[39m
    },
    _writableState: WritableState {
      highWaterMark: [33m65536[39m,
      length: [33m0[39m,
      corked: [33m0[39m,
      onwrite: [36m[Function: bound onwrite][39m,
      writelen: [33m0[39m,
      bufferedIndex: [33m0[39m,
      pendingcb: [33m0[39m,
      [32mSymbol(kState)[39m: [33m17580812[39m,
      [32mSymbol(kBufferedValue)[39m: [1mnull[22m
    },
    _maxListeners: [90mundefined[39m,
    _options: {
      maxRedirects: [33m21[39m,
      maxBodyLength: [33mInfinity[39m,
      protocol: [32m'http:'[39m,
      path: [32m'/mcp'[39m,
      method: [32m'POST'[39m,
      headers: [36m[Object: null prototype][39m,
      agents: [36m[Object][39m,
      auth: [90mundefined[39m,
      family: [90mundefined[39m,
      beforeRedirect: [36m[Function: dispatchBeforeRedirect][39m,
      beforeRedirects: [36m[Object][39m,
      hostname: [32m'localhost'[39m,
      port: [32m'4001'[39m,
      agent: [90mundefined[39m,
      nativeProtocols: [36m[Object][39m,
      pathname: [32m'/mcp'[39m
    },
    _ended: [33mfalse[39m,
    _ending: [33mtrue[39m,
    _redirectCount: [33m0[39m,
    _redirects: [],
    _requestBodyLength: [33m72[39m,
    _requestBodyBuffers: [ [36m[Object][39m ],
    _eventsCount: [33m3[39m,
    _onNativeResponse: [36m[Function (anonymous)][39m,
    _currentRequest: ClientRequest {
      _events: [36m[Object: null prototype][39m,
      _eventsCount: [33m7[39m,
      _maxListeners: [90mundefined[39m,
      outputData: [],
      outputSize: [33m0[39m,
      writable: [33mtrue[39m,
      destroyed: [33mfalse[39m,
      _last: [33mfalse[39m,
      chunkedEncoding: [33mfalse[39m,
      shouldKeepAlive: [33mtrue[39m,
      maxRequestsOnConnectionReached: [33mfalse[39m,
      _defaultKeepAlive: [33mtrue[39m,
      useChunkedEncodingByDefault: [33mtrue[39m,
      sendDate: [33mfalse[39m,
      _removedConnection: [33mfalse[39m,
      _removedContLen: [33mfalse[39m,
      _removedTE: [33mfalse[39m,
      strictContentLength: [33mfalse[39m,
      _contentLength: [33m72[39m,
      _hasBody: [33mtrue[39m,
      _trailer: [32m''[39m,
      finished: [33mfalse[39m,
      _headerSent: [33mtrue[39m,
      _closed: [33mfalse[39m,
      _header: [32m'POST /mcp HTTP/1.1\r\n'[39m +
        [32m'Accept: application/json, text/plain, */*\r\n'[39m +
        [32m'Content-Type: application/json\r\n'[39m +
        [32m'User-Agent: axios/1.11.0\r\n'[39m +
        [32m'Content-Length: 72\r\n'[39m +
        [32m'Accept-Encoding: gzip, compress, deflate, br\r\n'[39m +
        [32m'Host: localhost:4001\r\n'[39m +
        [32m'Connection: keep-alive\r\n'[39m +
        [32m'\r\n'[39m,
      _keepAliveTimeout: [33m0[39m,
      _onPendingData: [36m[Function: nop][39m,
      agent: [36m[Agent][39m,
      socketPath: [90mundefined[39m,
      method: [32m'POST'[39m,
      maxHeaderSize: [90mundefined[39m,
      insecureHTTPParser: [90mundefined[39m,
      joinDuplicateHeaders: [90mundefined[39m,
      path: [32m'/mcp'[39m,
      _ended: [33mfalse[39m,
      res: [1mnull[22m,
      aborted: [33mfalse[39m,
      timeoutCb: [36m[Function: emitRequestTimeout][39m,
      upgradeOrConnect: [33mfalse[39m,
      parser: [1mnull[22m,
      maxHeadersCount: [1mnull[22m,
      reusedSocket: [33mfalse[39m,
      host: [32m'localhost'[39m,
      protocol: [32m'http:'[39m,
      _redirectable: [36m[Circular *1][39m,
      [32mSymbol(shapeMode)[39m: [33mfalse[39m,
      [32mSymbol(kCapture)[39m: [33mfalse[39m,
      [32mSymbol(kBytesWritten)[39m: [33m0[39m,
      [32mSymbol(kNeedDrain)[39m: [33mfalse[39m,
      [32mSymbol(corked)[39m: [33m0[39m,
      [32mSymbol(kChunkedBuffer)[39m: [],
      [32mSymbol(kChunkedLength)[39m: [33m0[39m,
      [32mSymbol(kSocket)[39m: [36m[Socket][39m,
      [32mSymbol(kOutHeaders)[39m: [36m[Object: null prototype][39m,
      [32mSymbol(errored)[39m: [1mnull[22m,
      [32mSymbol(kHighWaterMark)[39m: [33m65536[39m,
      [32mSymbol(kRejectNonStandardBodyWrites)[39m: [33mfalse[39m,
      [32mSymbol(kUniqueHeaders)[39m: [1mnull[22m
    },
    _currentUrl: [32m'http://localhost:4001/mcp'[39m,
    _timeout: [1mnull[22m,
    [32mSymbol(shapeMode)[39m: [33mtrue[39m,
    [32mSymbol(kCapture)[39m: [33mfalse[39m
  },
  cause: AggregateError: 
  [90m    at internalConnectMultiple (node:net:1134:18)[39m
  [90m    at afterConnectMultiple (node:net:1715:7)[39m {
    code: [32m'ECONNREFUSED'[39m,
    [errors]: [ [36m[Error][39m, [36m[Error][39m ]
  }
}

stderr | tests/integration/api-endpoints.test.ts > Integration Tests > POST /mcp > should handle MCP protocol requests
⚠️ [ProviderMCPService] Failed to get MCP tools from file_service: Error: MCP tools request failed: HTTP request failed: 
    at ProviderMCPService.getMCPTools [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:266:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at ProviderMCPService.loadToolsFromServer [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:218:22[90m)[39m
    at ProviderMCPService.toolsList [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/provider-mcp-service.ts:85:23[90m)[39m
    at MCPService.aggregateToolsFromProviders [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/mcp-service.ts:172:29[90m)[39m
    at MCPService.handleToolsList [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/mcp-service.ts:142:24[90m)[39m
    at MCPService.routeRequest [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/mcp-service.ts:74:16[90m)[39m
    at MCPService.handleMCPRequest [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/core/mcp-service.ts:51:14[90m)[39m
    at handleMCPRequest [90m(/Users/nayandahaberty/Code/Cubicler/Cubicler/[39msrc/index.ts:388:20[90m)[39m

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /mcp > should handle MCP protocol requests
✅ [MCPService] Returning 4 tools from 3 providers

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /mcp > should handle MCP protocol requests
✅ [Server] POST /mcp - Success

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /mcp > should validate MCP request format
[dotenv@17.2.0] injecting env (7) from .env (tip: 🔐 encrypt with dotenvx: https://dotenvx.com)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /mcp > should validate MCP request format
[dotenv@17.2.0] injecting env (0) from .env (tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' })

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /mcp > should validate MCP request format
[dotenv@17.2.0] injecting env (0) from .env (tip: ⚙️  write to custom object with { processEnv: myObject })

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /mcp > should validate MCP request format
[dotenv@17.2.0] injecting env (0) from .env (tip: 🔐 encrypt with dotenvx: https://dotenvx.com)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /mcp > should validate MCP request format
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /mcp > should validate MCP request format
🔧 [DispatchService] Created with MCP service and agent provider

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > POST /mcp > should validate MCP request format
📡 [Server] POST /mcp - MCP request: tools/list

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > Error Handling > should handle 404 for unknown endpoints
[dotenv@17.2.0] injecting env (7) from .env (tip: 🔐 prevent committing .env to code: https://dotenvx.com/precommit)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > Error Handling > should handle 404 for unknown endpoints
[dotenv@17.2.0] injecting env (0) from .env (tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' })

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > Error Handling > should handle 404 for unknown endpoints
[dotenv@17.2.0] injecting env (0) from .env (tip: 🛠️  run anywhere with `dotenvx run -- yourcommand`)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > Error Handling > should handle 404 for unknown endpoints
[dotenv@17.2.0] injecting env (0) from .env (tip: 🔐 encrypt with dotenvx: https://dotenvx.com)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > Error Handling > should handle 404 for unknown endpoints
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > Error Handling > should handle 404 for unknown endpoints
🔧 [DispatchService] Created with MCP service and agent provider

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > Error Handling > should handle invalid JSON in request body
[dotenv@17.2.0] injecting env (7) from .env (tip: 🛠️  run anywhere with `dotenvx run -- yourcommand`)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > Error Handling > should handle invalid JSON in request body
[dotenv@17.2.0] injecting env (0) from .env (tip: 🔐 prevent committing .env to code: https://dotenvx.com/precommit)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > Error Handling > should handle invalid JSON in request body
[dotenv@17.2.0] injecting env (0) from .env (tip: ⚙️  override existing env vars with { override: true })

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > Error Handling > should handle invalid JSON in request body
[dotenv@17.2.0] injecting env (0) from .env (tip: 🛠️  run anywhere with `dotenvx run -- yourcommand`)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > Error Handling > should handle invalid JSON in request body
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > Error Handling > should handle invalid JSON in request body
🔧 [DispatchService] Created with MCP service and agent provider

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > Error Handling > should handle invalid JSON in request body
⚠️ [Server] Invalid JSON in request body

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should not include CORS headers when CORS is disabled (default)
[dotenv@17.2.0] injecting env (7) from .env (tip: ⚙️  write to custom object with { processEnv: myObject })

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should not include CORS headers when CORS is disabled (default)
[dotenv@17.2.0] injecting env (0) from .env (tip: ⚙️  override existing env vars with { override: true })

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should not include CORS headers when CORS is disabled (default)
[dotenv@17.2.0] injecting env (0) from .env (tip: ⚙️  enable debug logging with { debug: true })

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should not include CORS headers when CORS is disabled (default)
[dotenv@17.2.0] injecting env (0) from .env (tip: 🔐 prevent building .env in docker: https://dotenvx.com/prebuild)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should not include CORS headers when CORS is disabled (default)
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should not include CORS headers when CORS is disabled (default)
🔧 [DispatchService] Created with MCP service and agent provider

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should not include CORS headers when CORS is disabled (default)
🏥 [Server] Health check requested
📋 [ConfigHelper] Loading agents configuration from: ./tests/mocks/test-agents.json
📁 [ConfigHelper] Loading from local file...
✅ [ConfigHelper] Successfully loaded agents configuration from local file
🔄 [ConfigHelper] Applied environment variable substitution to agents configuration

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should not include CORS headers when CORS is disabled (default)
✅ [AgentRepository] Loaded 2 agents

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should not include CORS headers when CORS is disabled (default)
📋 [ConfigHelper] Loading providers configuration from: ./tests/mocks/test-providers.json
📁 [ConfigHelper] Loading from local file...
✅ [ConfigHelper] Successfully loaded providers configuration from local file
🔄 [ConfigHelper] Applied environment variable substitution to providers configuration

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should not include CORS headers when CORS is disabled (default)
✅ [ProvidersRepository] Loaded 2 MCP servers and 1 REST servers

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should not include CORS headers when CORS is disabled (default)
🔄 [ProviderRepository] Config changed, updating server metadata...
✅ [ProviderRepository] Updated metadata for 3 servers

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should not include CORS headers when CORS is disabled (default)
✅ [Server] Health check: healthy

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should include CORS headers when CORS is enabled
[dotenv@17.2.0] injecting env (7) from .env (tip: 🔐 encrypt with dotenvx: https://dotenvx.com)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should include CORS headers when CORS is enabled
[dotenv@17.2.0] injecting env (0) from .env (tip: 🔐 prevent committing .env to code: https://dotenvx.com/precommit)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should include CORS headers when CORS is enabled
[dotenv@17.2.0] injecting env (0) from .env (tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' })

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should include CORS headers when CORS is enabled
[dotenv@17.2.0] injecting env (0) from .env (tip: 🔐 prevent committing .env to code: https://dotenvx.com/precommit)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should include CORS headers when CORS is enabled
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should include CORS headers when CORS is enabled
🔧 [DispatchService] Created with MCP service and agent provider

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should include CORS headers when CORS is enabled
[dotenv@17.2.0] injecting env (0) from .env (tip: 🔐 prevent committing .env to code: https://dotenvx.com/precommit)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should include CORS headers when CORS is enabled
[dotenv@17.2.0] injecting env (0) from .env (tip: 🔐 prevent committing .env to code: https://dotenvx.com/precommit)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should include CORS headers when CORS is enabled
[dotenv@17.2.0] injecting env (0) from .env (tip: 🛠️  run anywhere with `dotenvx run -- yourcommand`)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should include CORS headers when CORS is enabled
[dotenv@17.2.0] injecting env (0) from .env (tip: 🔐 prevent committing .env to code: https://dotenvx.com/precommit)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should include CORS headers when CORS is enabled
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should include CORS headers when CORS is enabled
🔧 [DispatchService] Created with MCP service and agent provider

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should include CORS headers when CORS is enabled
🏥 [Server] Health check requested
📋 [ConfigHelper] Loading agents configuration from: ./tests/mocks/test-agents.json
📁 [ConfigHelper] Loading from local file...
✅ [ConfigHelper] Successfully loaded agents configuration from local file
🔄 [ConfigHelper] Applied environment variable substitution to agents configuration

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should include CORS headers when CORS is enabled
✅ [AgentRepository] Loaded 2 agents

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should include CORS headers when CORS is enabled
📋 [ConfigHelper] Loading providers configuration from: ./tests/mocks/test-providers.json
📁 [ConfigHelper] Loading from local file...
✅ [ConfigHelper] Successfully loaded providers configuration from local file
🔄 [ConfigHelper] Applied environment variable substitution to providers configuration

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should include CORS headers when CORS is enabled
✅ [ProvidersRepository] Loaded 2 MCP servers and 1 REST servers

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should include CORS headers when CORS is enabled
🔄 [ProviderRepository] Config changed, updating server metadata...
✅ [ProviderRepository] Updated metadata for 3 servers

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should include CORS headers when CORS is enabled
✅ [Server] Health check: healthy

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should handle preflight OPTIONS requests when CORS is enabled
[dotenv@17.2.0] injecting env (7) from .env (tip: 🔐 prevent committing .env to code: https://dotenvx.com/precommit)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should handle preflight OPTIONS requests when CORS is enabled
[dotenv@17.2.0] injecting env (0) from .env (tip: 🔐 prevent committing .env to code: https://dotenvx.com/precommit)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should handle preflight OPTIONS requests when CORS is enabled
[dotenv@17.2.0] injecting env (0) from .env (tip: ⚙️  write to custom object with { processEnv: myObject })

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should handle preflight OPTIONS requests when CORS is enabled
[dotenv@17.2.0] injecting env (0) from .env (tip: ⚙️  override existing env vars with { override: true })

stderr | tests/utils/env-helper.test.ts > Environment Helper > getEnvTimeout > should return default for invalid number
⚠️ [EnvHelper] Invalid timeout value for TEST_TIMEOUT: not_a_number. Using default: 2000ms

stderr | tests/utils/env-helper.test.ts > Environment Helper > getEnvTimeout > should return default for negative numbers
⚠️ [EnvHelper] Invalid timeout value for TEST_TIMEOUT: -500. Using default: 1500ms

stderr | tests/utils/env-helper.test.ts > Environment Helper > getEnvTimeout > should return default for zero
⚠️ [EnvHelper] Invalid timeout value for TEST_TIMEOUT: 0. Using default: 1200ms

 ✓ tests/utils/parameter-helper.test.ts (14 tests) 7ms
 ✓ tests/utils/env-helper.test.ts (12 tests) 17ms
stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should handle preflight OPTIONS requests when CORS is enabled
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should handle preflight OPTIONS requests when CORS is enabled
🔧 [DispatchService] Created with MCP service and agent provider

 ✓ tests/transport/mcp/stdio-mcp-transport.test.ts (6 tests) 6ms
 ✓ tests/utils/source-helper.test.ts (26 tests) 23ms
stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should handle preflight OPTIONS requests when CORS is enabled
[dotenv@17.2.0] injecting env (0) from .env (tip: 🔐 prevent committing .env to code: https://dotenvx.com/precommit)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should handle preflight OPTIONS requests when CORS is enabled
[dotenv@17.2.0] injecting env (0) from .env (tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' })

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should handle preflight OPTIONS requests when CORS is enabled
[dotenv@17.2.0] injecting env (0) from .env (tip: 🛠️  run anywhere with `dotenvx run -- yourcommand`)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should handle preflight OPTIONS requests when CORS is enabled
[dotenv@17.2.0] injecting env (0) from .env (tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' })

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should handle preflight OPTIONS requests when CORS is enabled
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should handle preflight OPTIONS requests when CORS is enabled
🔧 [DispatchService] Created with MCP service and agent provider

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should not handle preflight OPTIONS requests when CORS is disabled
[dotenv@17.2.0] injecting env (7) from .env (tip: ⚙️  override existing env vars with { override: true })

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should not handle preflight OPTIONS requests when CORS is disabled
[dotenv@17.2.0] injecting env (0) from .env (tip: 🔐 prevent building .env in docker: https://dotenvx.com/prebuild)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should not handle preflight OPTIONS requests when CORS is disabled
[dotenv@17.2.0] injecting env (0) from .env (tip: 🔐 prevent committing .env to code: https://dotenvx.com/precommit)

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should not handle preflight OPTIONS requests when CORS is disabled
[dotenv@17.2.0] injecting env (0) from .env (tip: ⚙️  write to custom object with { processEnv: myObject })

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should not handle preflight OPTIONS requests when CORS is disabled
🔧 [MCPService] Created with 3 MCPCompatible providers

stdout | tests/integration/api-endpoints.test.ts > Integration Tests > CORS Headers > should not handle preflight OPTIONS requests when CORS is disabled
🔧 [DispatchService] Created with MCP service and agent provider

 ❯ tests/integration/api-endpoints.test.ts (14 tests | 1 failed) 26860ms
   × Integration Tests > GET /health > should return health check 10607ms
     → Hook timed out in 10000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
   ✓ Integration Tests > GET /agents > should return list of available agents  6855ms
   ✓ Integration Tests > POST /dispatch > should validate request body  679ms
   ✓ Integration Tests > POST /dispatch > should validate messages array  681ms
   ✓ Integration Tests > POST /dispatch > should handle malformed message format  692ms
   ✓ Integration Tests > POST /dispatch/:agentId > should accept agent ID parameter  1990ms
   ✓ Integration Tests > POST /mcp > should handle MCP protocol requests  1440ms
   ✓ Integration Tests > POST /mcp > should validate MCP request format  1629ms
   ✓ Integration Tests > Error Handling > should handle 404 for unknown endpoints  607ms
   ✓ Integration Tests > Error Handling > should handle invalid JSON in request body 39ms
   ✓ Integration Tests > CORS Headers > should not include CORS headers when CORS is disabled (default) 72ms
   ✓ Integration Tests > CORS Headers > should include CORS headers when CORS is enabled 102ms
   ✓ Integration Tests > CORS Headers > should handle preflight OPTIONS requests when CORS is enabled  1315ms
   ✓ Integration Tests > CORS Headers > should not handle preflight OPTIONS requests when CORS is disabled 149ms
stdout | tests/core/server-config-service.test.ts > ServerConfigService > loadConfig > should load default configuration when no config source specified
📋 [ServerConfig] Using default configuration

stdout | tests/core/server-config-service.test.ts > ServerConfigService > loadConfig > should use environment variables for default configuration
📋 [ServerConfig] Using default configuration

stdout | tests/core/server-config-service.test.ts > ServerConfigService > loadConfig > should load configuration from file when CUBICLER_CONFIG is set
✅ [ServerConfig] Configuration loaded successfully

stdout | tests/core/server-config-service.test.ts > ServerConfigService > loadConfig > should merge file config with default config
✅ [ServerConfig] Configuration loaded successfully

stdout | tests/core/server-config-service.test.ts > ServerConfigService > loadConfig > should fall back to default config when file loading fails
📋 [ServerConfig] Falling back to default configuration

stderr | tests/core/server-config-service.test.ts > ServerConfigService > loadConfig > should fall back to default config when file loading fails
⚠️ [ServerConfig] Failed to load config from non-existent-cubicler.json: File not found

stdout | tests/core/server-config-service.test.ts > ServerConfigService > loadConfig > should cache configuration after first load
📋 [ServerConfig] Using default configuration

stdout | tests/core/server-config-service.test.ts > ServerConfigService > getConfig > should return cached config after loading
📋 [ServerConfig] Using default configuration

stdout | tests/core/server-config-service.test.ts > ServerConfigService > getEndpointJwtConfig > should return endpoint-specific JWT config
✅ [ServerConfig] Configuration loaded successfully

stdout | tests/core/server-config-service.test.ts > ServerConfigService > getEndpointJwtConfig > should fall back to global JWT config when endpoint-specific not found
✅ [ServerConfig] Configuration loaded successfully

stdout | tests/core/server-config-service.test.ts > ServerConfigService > getEndpointJwtConfig > should return null when no JWT config is found
📋 [ServerConfig] Using default configuration

stdout | tests/core/server-config-service.test.ts > ServerConfigService > isJwtEnabled > should return false when no JWT config exists
📋 [ServerConfig] Using default configuration

stdout | tests/core/server-config-service.test.ts > ServerConfigService > isJwtEnabled > should return true when endpoint-specific JWT config exists
✅ [ServerConfig] Configuration loaded successfully

stdout | tests/core/server-config-service.test.ts > ServerConfigService > isJwtEnabled > should return true when global JWT config exists
✅ [ServerConfig] Configuration loaded successfully

stdout | tests/core/server-config-service.test.ts > ServerConfigService > clearCache > should clear cached configuration
📋 [ServerConfig] Using default configuration

 ✓ tests/core/server-config-service.test.ts (16 tests) 6ms
 ✓ tests/utils/fetch-helper.test.ts (16 tests) 7ms
stdout | tests/utils/env-object-debug.test.ts > Environment Variable Object Substitution Debug > should substitute environment variables in nested objects
Input: {
  "mcpServers": [
    {
      "identifier": "test_service",
      "name": "Test Service",
      "url": "{{env.SERVICE_URL}}/mcp",
      "headers": {
        "Authorization": "Bearer {{env.API_TOKEN}}"
      }
    }
  ]
}
Output: {
  "mcpServers": [
    {
      "identifier": "test_service",
      "name": "Test Service",
      "url": "http://localhost:4000/mcp",
      "headers": {
        "Authorization": "Bearer secret-token"
      }
    }
  ]
}

 ✓ tests/utils/env-object-debug.test.ts (1 test) 4ms
stdout | tests/core/provider-service.test.ts
[dotenv@17.2.0] injecting env (10) from .env (tip: ⚙️  override existing env vars with { override: true })

stdout | tests/core/provider-service.test.ts
[dotenv@17.2.0] injecting env (0) from .env (tip: 🔐 encrypt with dotenvx: https://dotenvx.com)

 ✓ tests/core/provider-service.test.ts (4 tests) 4ms
 ✓ tests/factory/agent-transport-factory.test.ts (6 tests) 4ms

⎯⎯⎯⎯⎯⎯⎯ Failed Tests 1 ⎯⎯⎯⎯⎯⎯⎯

 FAIL  tests/integration/api-endpoints.test.ts > Integration Tests > GET /health > should return health check
Error: Hook timed out in 10000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 ❯ tests/integration/api-endpoints.test.ts:9:3
      7|   const originalEnv = process.env;
      8| 
      9|   beforeEach(async () => {
       |   ^
     10|     vi.resetModules();
     11|     process.env = { ...originalEnv };

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/1]⎯


 Test Files  1 failed | 33 passed (34)
      Tests  1 failed | 514 passed (515)
   Start at  12:50:30
   Duration  32.37s (transform 26.74s, setup 0ms, collect 78.77s, tests 33.51s, environment 11ms, prepare 12.86s)

